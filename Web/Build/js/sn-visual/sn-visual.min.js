var sn=typeof sn==null||typeof sn!="object"?{}:sn;const _emptyStr=String.fromCharCode();this._isNullOrEmpty=function(n){return n===undefined||n==null||n.length<=0?!0:!1};this._isNotNullOrEmpty=function(n){return _isNullOrEmpty(n)==!1};this._get={d3:{header:function(n){return d3.select("#header"+n)},title:function(n){return d3.select("#title"+n)},titleContainer:function(n){return d3.select("#title_container"+n)},holder:function(n){return d3.select("#holder"+n)},resizeFull:function(n){return d3.select("#resize_full"+n)},resizeSmall:function(n){return d3.select("#resize_small"+n)},tooltip:function(n){return d3.select("#tooltip"+n)},visual:function(n){return d3.select("#visual"+n)},tcaption:function(n){return d3.select("#tcaption"+n)}},id:{header:function(n){return"header"+n},title:function(n){return"title"+n},titleContainer:function(n){return"title_container"+n},holder:function(n){return"holder"+n},resizeFull:function(n){return"resize_full"+n},resizeSmall:function(n){return"resize_small"+n},tooltip:function(n){return"tooltip"+n},visual:function(n){return"visual"+n},tcaption:function(n){return d3.select("tcaption"+n)}},is_visual_interactable:function(n){let t=!1;if(n){let r=n.option.behaviour.interactionMode,i=n.listener;t=r=="auto"&&n.children&&n.children.length>0||r=="manual"&&i&&i.onVisualElementClick&&typeof i.onVisualElementClick=="function"||r=="semi-auto"&&i&&i.beforeRefresh&&typeof i.beforeRefresh=="function"}return t},json_cloned:function(n){return JSON.parse(JSON.stringify(n))}};this._set={element:{text_as_title:function(n){let t=document.getElementById(n);t.offsetWidth<t.scrollWidth&&t.setAttribute("title",t.innerText)}}};sn.visual={about:{get copyright(){return this._local.copyrightText},get released(){return this._local.releasedDate},get version(){return this._local.majorVersion+"."+this._local.minorVersion+"."+this._local.revisionNumber},get all(){return'SN.Visual - version <font style="color:white;font-weight:bold;">'+this.version+"<\/font> "+this.copyright+' <br>released <font style="color:white;font-weight:bold;">'+this.released+"<\/font>"},_local:{majorVersion:1,minorVersion:6,revisionNumber:4,releasedDate:"14-05-2018",copyrightText:"Â© 2018 South Nests Software Solutions Pvt. Ltd."}},"default":{param:{holder:{elementSelector:"body"},basic:{title:""},pattern:{type:"bar",orientation:"vertical",dataKey:{baseAxis:{textDirection:"w-to-e"},plotAxis:{textDirection:"w-to-e",tickStyle:"auto",tickIncrement:1}},legend:{position:"ne",orientation:"vertical",shape:"rect"}},dataSource:{format:"json"},decoration:{textSize:8},option:{elementShadow:!1,behaviour:{interactionMode:"auto"},suppress:{blankTicks:!0,elementShadow:!0,legend:!1,randomColors:!0,textOnElement:!0,tileBorder:!0,tileHeader:!0,toolBar:!0,transition:!1,visualBorder:!0,checkBox:!0},colorScheme:["pbi-default-bright","pbi-default-darker","pbi-default-dark","pbi-default-normal"]},scale:{tile:{padding:2,margin:5,headerBarHeight:20,backgroundColor:"white",hostColor:"#0f2758"},legend:{width:100},get width(){var n=this._local;return _isNullOrEmpty(n.width)?n.xRatio*n.factor:n.width},get maxwidth(){var n=this._local;return n.maxwidth==null?n.xRatio*n.maxfactor:n.maxwidth},set width(n){this._local.width=n},get height(){var n=this._local;return n.height==null?n.yRatio*n.factor:n.height},get maxheight(){var n=this._local;return n.maxheight==null?n.yRatio*n.maxfactor:n.maxheight},set height(n){this._local.height=n},get margin(){return this._local.margin},set margin(n){return this._local.margin=n>l.margin?l.margin:n,this._local.margin},_local:{width:null,height:null,maxwidth:1e3,maxheight:390,margin:40,xRatio:3,yRatio:2,factor:100,maxfactor:225}}},zeroPlotValue:{elementSize:1,textColor:"#555555",elementColor:"#FFFFFF"},maxZIndex:2147483647},helper:{getUniqueId:function(n,t,i){t=t==null||t>17?17:t.length==0?t+1:t;n=n==null?"":n;i=i==null?"":i;var r=Math.round(Math.random()*Math.pow(10,t));return(n+r+i).replace(/ /g,"")},getVisualTypeNames:function(){return sn.visual._core_lib._pattern_types.getVisualTypeNames()},getLegendValues:function(n){var t=[];return n._data.forEach(function(i){t.indexOf(i[n.pattern.dataKey.baseAxis.key])<0&&t.push(i[n.pattern.dataKey.baseAxis.key])}),t},getMouseAtContext:function(n){var t=document.getElementById(n).getBoundingClientRect();return t.midX=t.x+t.width/2,t.midY=t.y+t.height/2,{"visual-left":t.left,"visual-top":t.top,"mid-x":t.midX,"mid-y":t.midY,"at-right-top":d3.event.pageX>=t.midX&&d3.event.pageY<t.midY,"at-right-bottom":d3.event.pageX>=t.midX&&d3.event.pageY>=t.midY,"at-left-bottom":d3.event.pageX<t.midX&&d3.event.pageY>=t.midY,"at-left-top":d3.event.pageX<t.midX&&d3.event.pageY<t.midY,"page-x":d3.event.pageX,"page-y":d3.event.pageY}},setUniqueIdToData:function(n){return n._data.forEach(function(n){if(n._id==null){var t="_ui_";Object.keys(n).filter(t=>typeof n[t]!="object").forEach(function(i){t+=n[i]});t=t.replace(/ /g,"sp").replace(/-/g,"ms");n._id=t}})},reduceParamPlotValue:function(n,t){if(_isNotNullOrEmpty(n.pattern.dataKey.plotAxis.reduceMethod)){var i,u=n.pattern.dataKey.plotAxis.key,f=n.pattern.dataKey.plotAxis.groupValueKey,r=n.pattern.dataKey.plotAxis.reduceMethod;t.forEach(function(t){if(n.children!=null&&n.children.forEach(function(n){sn.visual.helper.reduceParamPlotValue(n,t[n.pattern.dataKey.baseAxis.dataSourceKey])}),i=0,r=="count")i=t[n.pattern.dataKey.baseAxis.groupKey].length;else{var e=[];t[n.pattern.dataKey.baseAxis.groupKey].forEach(function(n){e.push(n[f])});r=="sum"||r=="avg"?i=e.reduce(function(n,t){return n+t}):r=="min"?i=d3.entries(e).sort(function(n,t){return d3.ascending(n.value,t.value)})[0].value:r=="max"&&(i=d3.entries(e).sort(function(n,t){return d3.descending(n.value,t.value)})[0].value);r=="avg"&&(i=i/e.length)}t[u]=i})}},reduceToSummaryValue:function(n,t){var i=t.pattern.dataKey.plotAxis;if(n==t.pattern.dataKey.baseAxis.key)return _isNullOrEmpty(i.summaryTitle)==!1?i.summaryTitle:i.summaryReduceMethod=="sum"?"Total":i.summaryReduceMethod=="avg"?"Average":i.summaryReduceMethod=="min"?"Minimum":i.summaryReduceMethod=="max"?"Maximum":i.summaryReduceMethod=="count"?"Count":_emptyStr;if(n==t.pattern.dataKey.plotAxis.key){let n=0;return i.summaryReduceMethod=="count"?n=t._data.length:i.summaryReduceMethod=="sum"||i.summaryReduceMethod=="avg"?(n=d3.sum(t._data,function(n){return n[t.pattern.dataKey.plotAxis.key]}),i.summaryReduceMethod=="avg"&&(n=n/t._data.length)):i.summaryReduceMethod=="min"?n=d3.entries(plotValues).sort(function(n,t){return d3.ascending(n.value,t.value)})[0].value:i.summaryReduceMethod=="max"&&(n=d3.entries(plotValues).sort(function(n,t){return d3.descending(n.value,t.value)})[0].value),n}return _emptyStr},reduceSelectedAll:function(n,t){var u,o,f,s,i,h,e,c,l;const r=[];if(_isNotNullOrEmpty(n)==!0&&t.length>0){const p=n.pattern.dataKey.baseAxis.groupKey,v=n.pattern.dataKey.baseAxis.key,y=n.pattern.dataKey.plotAxis.key,a=Object.keys(t[0]);for(delete a.splice(a.indexOf(v),1),delete a.splice(a.indexOf(y),1),t=_get.json_cloned(t),o=0;o<t.length;o++)if(u=t[o],f=r.findIndex(n=>n[v]==u[v]),f<0?(s={},s[v]=u[v],s[y]=u[y],r.push(s),f=r.length-1):r[f][y]+=u[y],n.children!=null&&n.children.length>0){const t=n.children[0],o=t.pattern.dataKey.baseAxis.key,s=t.pattern.dataKey.plotAxis.key;for(h=0;h<a.length;h++)if(i=a[h],r[f][i]==null)r[f][i]=u[i];else if(Array.isArray(u[i])==!0)for(e=0,c=0;c<u[i].length;c++)e=u[i][c],l=r[f][i].findIndex(n=>n[o]==e[o]),l<0?r[f][i].push(e):r[f][i][l][s]+=e[s];else typeof u[i]=="object"}}return r},validateParam:function(n){var i,r,u,t;this.patternMinimumValid=!1;try{if(n==null)throw{error:"param is not specified",key:"param",value:n};if(n.holder==null)throw{error:"param.holder is not specified",key:"param.holder",value:n.holder};if(_isNullOrEmpty(n.holder.elementSelector))throw{error:"holder.elementSelector is not specified",key:"holder.elementSelector",value:n.holder.elementSelector};if(d3.select(n.holder.elementSelector).size()==0)throw{error:"No element found seleced using the mentioned element selector",key:"holder.elementSelector",value:n.holder.elementSelector};if(n.pattern==null)throw{error:"param.pattern is not specified",key:"param",value:n};if(n.pattern.type==null)throw{error:"pattern.type is not specified",key:"pattern",value:n.pattern};if(i=sn.visual._core_lib._pattern_types,n.pattern.type=n.pattern.type=="donut"?"doughnut":n.pattern.type,i.getAllTypes().indexOf(n.pattern.type)<0)if(r=sn.visual.helper.getVisualTypeNames().indexOf(n.pattern.type),r<0)throw{error:"pattern.type should have any one of these values",validList:i.getAllTypes(),key:"pattern",value:n.pattern};else n.pattern.type=i.getAllTypes()[r];if(u=sn.visual._core_lib._pattern_types._isAxisBasedVisual(n.pattern.type),n.pattern.dataKey==null)throw{error:"pattern.dataKey is not specified",key:"pattern",value:n.pattern};if(n.pattern.dataKey.baseAxis==null)throw{error:"dataKey.baseAxis is not specified",key:"dataKey",value:n.pattern.dataKey};if(n.pattern.dataKey.baseAxis.key==null)throw{error:"baseAxis.key is not specified",key:"baseAxis",value:n.pattern.dataKey.baseAxis};if(_isNotNullOrEmpty(n.pattern.dataKey.baseAxis.textDirection)&&sn.visual._core_lib._get_text_direction().indexOf(n.pattern.dataKey.baseAxis.textDirection)<0)throw{error:"baseAxis.textDirection should have any one of these values",validList:sn.visual._core_lib._get_text_direction(),key:"baseAxis",value:n.pattern.dataKey.baseAxis};if(n.pattern.dataKey.baseAxis.moreKey!=null){let t=n.pattern.dataKey.baseAxis.moreKey;if(Array.isArray(t)==!1&&typeof t!="object")throw{error:"baseAxis.moreKey does not seem to be an array",key:"baseAxis",value:n.pattern.dataKey.baseAxis};}if(n.pattern.dataKey.plotAxis==null)throw{error:"dataKey.plotAxis is not specified",key:"dataKey",value:n.pattern.dataKey};if(n.pattern.dataKey.plotAxis.key==null)throw{error:"plotAxis.key is not specified",key:"plotAxis",value:n.pattern.dataKey.plotAxis};if(sn.visual._core_lib._pattern_types._isAxisBasedVisual(n.pattern.type)==!0){if(_isNotNullOrEmpty(n.pattern.dataKey.plotAxis.textDirection)&&sn.visual._core_lib._get_text_direction().indexOf(n.pattern.dataKey.plotAxis.textDirection)<0)throw{error:"plotAxis.textDirection should have any one of these values",validList:sn.visual._core_lib._get_text_direction(),key:"plotAxis",value:n.pattern.dataKey.plotAxis};if(_isNotNullOrEmpty(n.pattern.dataKey.plotAxis.tickStyle)&&sn.visual._core_lib._get_tick_style().indexOf(n.pattern.dataKey.plotAxis.tickStyle)<0)throw{error:"plotAxis.tickStyle should have any one of these values",validList:sn.visual._core_lib._get_tick_style(),key:"plotAxis",value:n.pattern.dataKey.plotAxis};}if(_isNotNullOrEmpty(n.pattern.dataKey.plotAxis.reduceMethod)&&sn.visual._core_lib._get_reduce_methods().indexOf(n.pattern.dataKey.plotAxis.reduceMethod)<0)throw{error:"plotAxis.reduceMethod should have any one of these values",validList:sn.visual._core_lib._get_reduce_methods(),key:"plotAxis",value:n.pattern.dataKey.plotAxis};if(_isNotNullOrEmpty(n.pattern.dataKey.plotAxis.summaryReduceMethod)&&sn.visual._core_lib._get_reduce_methods().indexOf(n.pattern.dataKey.plotAxis.summaryReduceMethod)<0)throw{error:"plotAxis.summaryReduceMethod should have any one of these values",validList:sn.visual._core_lib._get_reduce_methods(),key:"plotAxis",value:n.pattern.dataKey.plotAxis};if(_isNotNullOrEmpty(n.decoration)){if(_isNotNullOrEmpty(n.decoration.textSize)&&parseInt(n.decoration.textSize)==NaN)throw{error:"decoration.textSize is not a number",key:"decoration",value:n.decoration};if(n.decoration.textSize<8||n.decoration.textSize>40)throw{error:"decoration.textSize should be in the range of 8 and 40",key:"decoration",value:n.decoration};}if(_isNotNullOrEmpty(n.option)==!0){if(n.option.suppress&&Array.isArray(n.option.suppress)){let t=[];sn.visual._core_lib._get_valid_suppress_options().forEach(function(n){t.push(n.toLowerCase())});n.option.suppress.forEach(function(i){if(t.indexOf(i.toLowerCase())<0)throw{error:"option.suppress should have any one of these values",validList:sn.visual._core_lib._get_valid_suppress_options(),key:"option.suppress",value:n.option.suppress};})}if(_isNotNullOrEmpty(n.option.suppress)&&n.option.suppress.legend!=!0&&_isNotNullOrEmpty(n.pattern.legend)){if(_isNotNullOrEmpty(n.pattern.legend.position)&&sn.visual._core_lib._get_position_list().indexOf(n.pattern.legend.position)<0)throw{error:"legend.position should have any one of these values",validList:sn.visual._core_lib._get_position_list(),key:"legend",value:n.pattern.legend};if(_isNotNullOrEmpty(n.pattern.legend.orientation)&&sn.visual._core_lib._get_orientation_list().indexOf(n.pattern.legend.orientation)<0)throw{error:"legend.orientation should have any one of these values",validList:sn.visual._core_lib._get_orientation_list(),key:"legend",value:n.pattern.legend};}if(_isNotNullOrEmpty(n.option.colorScheme)){let t=Object.keys(sn.visual._color_scheme);if(typeof n.option.colorScheme=="string"){if(t.filter(t=>t==n.option.colorScheme).length<1)throw{error:"option.colorScheme should have any of these values",validList:t,key:"option",value:n.option};}else Array.isArray(n.option.colorScheme)&&n.option.colorScheme.forEach(function(i){if(t.filter(n=>n==i).length<1)throw{error:"option.colorScheme should have any of these values",validList:t,key:"option",value:n.option};})}if(_isNotNullOrEmpty(n.option.behaviour.interactionMode)&&sn.visual._core_lib._get_interaction_mode_list().filter(t=>t==n.option.behaviour.interactionMode).length<1)throw{error:"option.behaviour.interactionMode should have any of these values",validList:sn.visual._core_lib._get_interaction_mode_list(),key:"option",value:n.option};}if(n.data==null){if(n.dataSource==null)throw{error:"param.dataSource is expected in the absence of param.data",key:"param",value:n};if(_isNotNullOrEmpty(n.dataSource.format)&&sn.visual._core_lib._data_formats.getAllFormats().indexOf(n.dataSource.format)<0)throw{error:"dataSource.format should have any one of these value(s)",validList:sn.visual._core_lib._data_formats.getAllFormats(),key:"param.dataSource",value:n.dataSource};if(n.dataSource.data&&(n.dataSource.format=n.dataSource.format?n.dataSource.format:sn.visual.default.param.dataSource.format,n.dataSource.format=="json"&&Array.isArray(n.dataSource.data)==!0)){if(n.dataSource.data.length==0)throw{error:"dataSource.data does not contain data",key:"dataSource",value:n.dataSource};if(n.dataSource.data.filter(n=>Array.isArray(n)!=!0&&typeof n=="object").length<n.dataSource.data.length)throw{error:"dataSource.data does not have one or more elements in json format (or) contains one or more nested json elements",key:"dataSource",value:n.dataSource};}if(n.option.behaviour.interactionMode=="auto"&&sn.visual._core_lib._transform_rawdata_to_data(n)==!1)throw{error:"Unable to transform raw data from dataSource as per the keys specified.",key:"param",value:n};}if(n.data==null)throw{error:"param.data is not specified",key:"param",value:n};if(Array.isArray(n.data)==!1)throw{error:"param.data is not an array",key:"param",value:n};if(n.data.length==0)throw{error:"Array param.data does not have element inside",key:"param",value:n};if(n.data.length>0){let r=Object.keys(n.data[0]).toString(),i;for(t=0;t<n.data.length;t++){if(typeof n.data[t]!="object")throw{error:`Element in param.data at index '${t}' does not seem to be a JSON`,key:"param.data["+t+"]",value:n.data[t]};if(i=Object.keys(n.data[t]),typeof n.data[t]=="object"&&i.length==0)throw{error:`JSON element in param.data at index '${t}' does not have any key`,key:"param.data["+t+"]",value:n.data[t]};if(i.toString()!=r)throw{error:`Key(s) of JSON element in param.data at index '${t}' differs in name or alpha-case from it's previous element(s)`,key:"param.data["+t+"]",value:n.data[t]};}if(u==!0&&n.pattern.type!="bar-grouped"&&n.option.behaviour.interactionMode=="auto"&&Object.keys(n.data[0]).indexOf(n.pattern.dataKey.baseAxis.key)<0)throw{error:`Unable to find baseAxis.key '${n.pattern.dataKey.baseAxis.key}' in data`,key:"param.data[0]",value:n.data[0]};if(this.paramHasChildren=n.children&&n.children.length>0&&n.children.filter(function(t){return t.pattern.dataKey.plotAxis.valueKey==n.pattern.dataKey.plotAxis.valueKey}).length>0,this.validateGroupKey=n.pattern.type=="bar-grouped"||n.children!=null&&this.paramHasChildren||n.pattern.dataKey.plotAxis.reduceMethod,this.validateBaseAxisMoreKey=n.pattern.dataKey.baseAxis.moreKey!=null,this.validateGroupElementKey=n.pattern.type=="bar-grouped"&&n.option.behaviour.interactionMode=="auto",this.validateGroupValueKey=_isNotNullOrEmpty(n.pattern.dataKey.plotAxis.groupValueKey),this.validatePlotAxiskey=n.pattern.type!="bar-grouped",this.validateBaseAxisMoreKey){let i=Object.keys(n.data[0]),t=n.pattern.dataKey.baseAxis.moreKey;t=Array.isArray(t)?t:[t];t.forEach(function(t){if(i.indexOf(t.key)<0)throw{error:"One of the key mentioned in baseAxis.moreKey does not present in data",key:"baseAxis",value:n.pattern.dataKey.baseAxis};if(_isNotNullOrEmpty(t.title)&&typeof t.title!="string")throw{error:"One of the title mentioned in baseAxis.moreKey does not seems to be valid",key:"baseAxis",value:n.pattern.dataKey.baseAxis};});n.pattern.dataKey.baseAxis.moreKey=t}if(this.validateGroupKey){if(n.pattern.dataKey.plotAxis.reduceMethod&&_isNullOrEmpty(n.pattern.dataKey.baseAxis.groupKey))throw{error:`plotAxis.reduceMethod is mentioned as '${n.pattern.dataKey.plotAxis.reduceMethod}', so baseAxis.groupKey is required to calculate the plot value from it's children`,key:"dataKey",value:n.pattern.dataKey};if(_isNullOrEmpty(n.pattern.dataKey.baseAxis.groupKey))throw{error:"baseAxis.groupKey is not specified",key:"baseAxis",value:n.pattern.dataKey.baseAxis};if(typeof n.data[0][n.pattern.dataKey.baseAxis.groupKey]!="object")throw{error:`Unable to find baseAxis.groupKey '${n.pattern.dataKey.baseAxis.groupKey}' as object in one or more element(s) data`,key:"param.data[0]",value:n.data[0]};if(this.paramHasChildren&&sn.visual._core_lib._is_group_key_one_of_data_source_key(n)==!1)throw{error:"One or more 'baseAxis.groupKey' is/are not matching with the 'dataSourceKey' of one of it's child",key:"param",value:n};}if(this.validateGroupElementKey&&_isNullOrEmpty(n.pattern.dataKey.baseAxis.groupElementKey))throw{error:"baseAxis.groupElementKey is not specified",key:"baseAxis",value:n.pattern.dataKey.baseAxis};if(this.validateGroupValueKey&&Object.keys(n.data[0][n.pattern.dataKey.baseAxis.groupKey][0]).indexOf(n.pattern.dataKey.plotAxis.groupValueKey)<0)throw{error:`Unable to find the mentioned plotAxis.groupValueKey '${n.pattern.dataKey.plotAxis.groupValueKey}' under baseAxis.groupKey '${n.pattern.dataKey.baseAxis.groupKey}' of data`,key:"param",value:n};if(this.validatePlotAxiskey&&Object.keys(n.data[0]).indexOf(n.pattern.dataKey.plotAxis.key)<0)throw{error:`Unable to find plotAxis.key '${n.pattern.dataKey.plotAxis.key}' in data`,key:"param.data[0]",value:n.data[0]};}this.patternMinimumValid=!0}catch(f){sn.visual.helper.handleException(f)}finally{return this.patternMinimumValid}},handleParam:function(n){var u,s,l,h,a,r,e,c,v,t,f,i,o;if(n!=null&&typeof n=="object"){if(u=_get.json_cloned(sn.visual.default.param),n.holder!=null?(s=n.holder,l=u.holder,s.elementSelector=_isNullOrEmpty(s.elementSelector)?l.elementSelector:s.elementSelector):n.holder=u.holder,n.basic!=null?(h=n.basic,a=u.basic,h.title=_isNullOrEmpty(h.title)?a.title:h.title):n.basic=u.basic,n.pattern!=null&&(i=n.pattern,o=u.pattern,i.dataKey.baseAxis.textDirection=i.dataKey!=null&&i.dataKey.baseAxis!=null&&i.dataKey.baseAxis.textDirection==null?o.dataKey.baseAxis.textDirection:i.dataKey.baseAxis.textDirection,i.dataKey.plotAxis.textDirection=i.dataKey!=null&&i.dataKey.plotAxis!=null&&i.dataKey.plotAxis.textDirection==null?o.dataKey.plotAxis.textDirection:i.dataKey.plotAxis.textDirection,i.dataKey.baseAxis.title=i.dataKey!=null&&i.dataKey.baseAxis!=null&&i.dataKey.baseAxis.title==null?i.dataKey.baseAxis.key:i.dataKey.baseAxis.title,i.dataKey.plotAxis.title=i.dataKey!=null&&i.dataKey.plotAxis!=null&&i.dataKey.plotAxis.title==null?i.dataKey.plotAxis.key:i.dataKey.plotAxis.title,sn.visual._core_lib._pattern_types._isAxisBasedVisual(n.pattern.type)==!0&&(i.dataKey.plotAxis.tickStyle=i.dataKey!=null&&i.dataKey.plotAxis!=null&&i.dataKey.plotAxis.tickStyle==null?o.dataKey.plotAxis.tickStyle:i.dataKey.plotAxis.tickStyle,i.dataKey.plotAxis.tickIncrement=i.dataKey!=null&&i.dataKey.plotAxis!=null&&i.dataKey.plotAxis.tickIncrement==null?o.dataKey.plotAxis.tickIncrement:i.dataKey.plotAxis.tickIncrement)),n.dataSource&&n.dataSource.data&&(n.dataSource.format=n.dataSource.format?n.dataSource.format:u.dataSource.format),n.scale!=null?(r=n.scale,e=u.scale,r.margin=parseInt(r.margin==null||r.margin<e.margin?e.margin:r.margin),r.width=parseInt(r.width==null?e.width:r.width),r.height=parseInt(r.height==null?e.height:r.height),r.tile!=null?(r.tile.margin=r.tile.margin==null?e.tile.margin:r.tile.margin,r.tile.padding=r.tile.padding==null?e.tile.padding:r.tile.padding,r.tile.headerBarHeight=r.tile.headerBarHeight==null?e.tile.headerBarHeight:r.tile.headerBarHeight,r.tile.backgroundColor=r.tile.backgroundColor==null?e.tile.backgroundColor:r.tile.backgroundColor):r.tile=e.tile,r.legend!=null?r.legend.width=r.legend.width==null?e.legend.width:r.legend.width:r.legend=e.legend,r.title!=null?r.title.height=r.title.height==null?e.title.height:r.title.height:r.title=e.title):n.scale=u.scale,n.decoration!=null?(c=n.decoration,v=u.decoration,c.textSize=c.textSize==null?v.textSize:c.textSize):n.decoration=u.decoration,n.option!=null)if(t=n.option,f=u.option,t.elementShadow=t.elementShadow==null?f.elementShadow:t.elementShadow,t.colorScheme=t.colorScheme==null?f.colorScheme:t.colorScheme,t.behaviour!=null?t.behaviour.interactionMode=t.behaviour.interactionMode==null?f.behaviour.interactionMode:t.behaviour.interactionMode:t.behaviour=f.behaviour,t.suppress!=null){if(Array.isArray(t.suppress)==!0){let n=t.suppress;t.suppress=f.suppress;n.forEach(function(n){t.suppress[n]=!0})}t.suppress.svgBorder!=null&&(t.suppress.visualBorder=t.suppress.svgBorder,delete t.suppress.svgBorder);t.suppress.elementShadow=t.suppress.elementShadow==null?typeof t.elementShadow=="boolean"?t.elementShadow==!1:f.suppress.elementShadow:t.suppress.elementShadow;t.suppress.legend=typeof t.suppress.legend!="boolean"?f.suppress.legend:t.suppress.legend;t.suppress.randomColors=!0;t.suppress.textOnElement=typeof t.suppress.textOnElement!="boolean"?f.suppress.textOnElement:t.suppress.textOnElement;t.suppress.tileBorder=typeof t.suppress.tileBorder!="boolean"?f.suppress.tileBorder:t.suppress.tileBorder;t.suppress.tileHeader=typeof t.suppress.tileHeader!="boolean"?f.suppress.tileHeader:t.suppress.tileHeader;t.suppress.toolBar=typeof t.suppress.toolBar!="boolean"?f.suppress.toolBar:t.suppress.toolBar;t.suppress.transition=typeof t.suppress.transition!="boolean"?f.suppress.transition:t.suppress.transition;t.suppress.visualBorder=typeof t.suppress.visualBorder!="boolean"?f.suppress.visualBorder:t.suppress.visualBorder;t.suppress.checkBox=typeof t.suppress.checkBox!="boolean"?f.suppress.checkBox:t.suppress.checkBox;sn.visual._core_lib._pattern_types._isAxisBasedVisual(n.pattern.type)==!0&&(t.suppress.blankTicks=typeof t.suppress.blankTicks!="boolean"?t.suppress.blankTicks:f.suppress.blankTicks)}else t.suppress=f.suppress;else n.option=u.option;return sn.visual._core_lib._set_colors_from_scheme(n),n.option.suppress.legend!=!0?(i=n.pattern,o=u.pattern,_isNotNullOrEmpty(i.legend)?(i.legend.position=i.legend.position==null?o.legend.position:i.legend.position,i.legend.orientation=i.legend.orientation==null?o.legend.orientation:i.legend.orientation):i.legend=o.legend,i.legend.shape=n.pattern.type=="pie"||n.pattern.type=="doughnut"||n.pattern.type=="bubble"||n.pattern.type=="line"||n.pattern.type=="curve-line"?"circle":"rect",i.legend.shape=i.legend.shape!=null?i.legend.shape:o.legend.shape,["n","s"].indexOf(i.legend.position)>=0?i.legend.orientation="horizontal":["e","w"].indexOf(i.legend.position)>=0&&(i.legend.orientation="vertical")):(n.holder=u.holder,n.scale=u.scale,n.option=u.option),n.option.suppress.tileHeader==!0&&(n.scale.tile.headerBarHeight=0),n}},handleException:function(n){n.error!=null?n.validList!=null?console.error(sn.visual._message_template.get("error-validlist-key-value"),n.error,n.validList,n.key,n.value):n.key!=null&&n.value!=null?console.error(sn.visual._message_template.get("error-key-value"),n.error,n.key,n.value):console.error(sn.visual._message_template.get("error"),n.error):n.warning!=null?n.validList!=null?console.warning(sn.visual._message_template.get("warning-validlist-key-value"),n.error,n.validList,n.key,n.value):n.key!=null&&n.value!=null?console.warning(sn.visual._message_template.get("warning-key-value"),n.error,n.key,n.value):console.error(sn.visual._message_template.get("warning"),n.warning):console.error("%s. %o",n.message,n)},saveAsSvg:function(n,t){n.attr("xmlns","http://www.w3.org/2000/svg");var r=n.outerHTML,u=new Blob(['<?xml version="1.0" standalone="no"?>\r\n',r],{type:"image/svg+xml;charset=utf-8"}),f=URL.createObjectURL(u),i=document.createElement("a");i.href=f;i.download=t;document.body.appendChild(i);i.click();document.body.removeChild(i)}},_core_lib:{_pattern_types:{types:[{type:"bar",name:"Bar chart","axis-type":!0,"chart-type":!0},{type:"bar-grouped",name:"Grouped Bar chart","axis-type":!0,"chart-type":!0},{type:"bubble",name:"Bubble chart","axis-type":!0,"chart-type":!0},{type:"line",name:"Line chart","axis-type":!0,"chart-type":!0},{type:"curve-line",name:"Curved-Line chart","axis-type":!0,"chart-type":!0},{type:"pie",name:"Pie chart","axis-type":!1,"chart-type":!0},{type:"doughnut",name:"Doughnut chart","axis-type":!1,"chart-type":!0},{type:"table",name:"Table","axis-type":null,"chart-type":!1},{type:"check-list",name:"Check List","axis-type":null,"chart-type":!1}],getTypesFiltered:function(n,t,i){var r=[];return i==null&&(i="type"),Object.values(this.types).filter(i=>i[n]==t).forEach(function(n){r.push(n[i])}),r},getAllTypes:function(){return this.getTypesFiltered()},getAxisTypes:function(){return this.getTypesFiltered("axis-type",!0)},getNonAxisTypes:function(){return this.getTypesFiltered("axis-type",!1)},getVisualTypeNames:function(){return this.getTypesFiltered("chart-type",!0,"name")},_isAxisBasedVisual:function(n){var t=sn.visual._core_lib._pattern_types;return t.getAxisTypes().indexOf(n)>=0},_isVisualChartType:function(n){var i=!1,t=sn.visual._core_lib._pattern_types;for(var r of Object.keys(t.types))if(t.types[r][n]!=null){i=t.types[r][n]["chart-type"]==!0;break}return i}},_set_interaction_mode:function(n,t){n==null&&console.error("sn.visual: Unable to set interaction mode.");n.option==null&&(n.option={});n.option.behaviour==null&&(n.option.behaviour={interactionMode:t});n.option.behaviour.interactionMode==null&&(n.option.behaviour.interactionMode=t)},_casacade_down_the_interaction_mode:function(n,t){if(n.children&&n.children.length>0){let r;for(var i=0;i<n.children.length;i++)r=n.children[i],this._set_interaction_mode(n,t),r.children&&r.children.length>0&&this._casacade_down_the_interaction_mode(r,t)}},_data_formats:{formats:[{format:"json",name:"JsON",description:"Javascript object Notation"},],getFormatsFiltered:function(n,t,i){var r=[];return i==null&&(i="format"),Object.values(this.formats).filter(i=>i[n]==t).forEach(function(n){r.push(n[i])}),r},getAllFormats:function(){return this.getFormatsFiltered()}},_get_valid_suppress_options:function(){return["blankTicks","elementShadow","legend","randomColors","tileBorder","tileHeader","toolBar","transition","visualBorder"]},_get_reduce_methods:function(){return["sum","avg","min","max","count"]},_get_text_direction:function(){return["sw-to-ne","w-to-e","nw-to-se","n-to-s","ne-to-sw","e-to-w","se-to-nw","s-to-n"]},_get_tick_style:function(){return["auto","blank","no-decimal"]},_get_orientation_list:function(){return["horizontal","vertical"]},_get_position_list:function(n){var t;return _isNotNullOrEmpty(n)==!0&&(n.scaleAffected=="width"?t=["ne","e","se","sw","w","nw"]:n.scaleAffected=="height"&&(t=["ne","n","nw","sw","s","se"])),t?t:["n","ne","e","se","s","sw","w","nw"]},_get_interaction_mode_list:function(){return["auto","semi-auto","manual"]},_get_colors_of_scheme:function(n){let t=[];return typeof n=="string"?t=sn.visual._color_scheme[n]:Array.isArray(n)&&n.forEach(function(n){t=t.concat(sn.visual._color_scheme[n])}),t},_get_rbg_string_to_hex_string:function(n){if(this.result="#000000",n&&n.toLowerCase().indexOf("rgb")>=0){var t=n.split("(")[1].split(")")[0].split(",").map(function(n){return n=parseInt(n).toString(16),n.length==1?"0"+n:n});this.result="#"+t.join("")}return this.result},_get_color_readable:function(n){var t,i=(Math.pow(256,3)-1)/2;hexColor=sn.visual._color_list[n];n=hexColor!=null?hexColor:this._get_rbg_string_to_hex_string(n);try{colorValue=parseInt(n.substring(1),16);t=Number.isNaN(colorValue)?n:"#"+(colorValue<i?"FFFFFF":"000000")}catch(r){t=n}return t},_get_colors_random:function(n,t){var r=[],f,i=[],u;if(typeof n=="string"?i=sn.visual._color_scheme[n]:Array.isArray(n)&&n.forEach(function(n){i=i.concat(sn.visual._color_scheme[n])}),t>0&&_isNotNullOrEmpty(i)&&(u=i.length,u>0))while(r.length<t)f=Math.floor(Math.random()*u),(r.length>=u||r.indexOf(i[f])<0)&&r.push(i[f]);return r},_get_visual_holder_size:function(n){return{width:n.scale.width+(n.pattern.type!="table"&&n.pattern.type!="check-list"?this._getLegendWidth(n):0)+n.scale.margin*2+n.scale.tile.padding*2,height:n.scale.height+n.scale.margin*2+n.scale.tile.padding*2+(n.option.suppress.tileHeader==!1?n.scale.tile.headerBarHeight:0)}},_get_visual_size:function(n){return{width:n.scale.width+(n.pattern.type!="table"&&n.pattern.type!="check-list"?this._getLegendWidth(n):0)+n.scale.margin*2+n.scale.tile.padding*2+(n.pattern.type=="table"?-5:0),height:n.scale.height+n.scale.margin*2+n.scale.tile.padding*2+(n.option.suppress.tileHeader==!1?n.scale.tile.headerBarHeight/-2:0)}},_getLegendWidth:function(n){return this._get_position_list({scaleAffected:"width"}).indexOf(n.pattern.legend.position)>=0?n.scale.legend.width:0},_getLegendHeight:function(n){return this._get_position_list({scaleAffected:"height"}).indexOf(n.pattern.legend.position)>=0?n.scale.legend.height:0},_set_colors_from_scheme:function(n,t){(n.pattern.dataKey.plotAxis.colors==null||t==!0)&&(n.pattern.dataKey.plotAxis.colors=n.option.suppress.randomColors==!0?sn.visual._core_lib._get_colors_of_scheme(n.option.colorScheme||defaultParam.option.colorScheme):sn.visual._core_lib._get_colors_random(n.option.colorScheme||defaultParam.option.colorScheme,n.data.length))},_set_axis_text_direction:function(n,t,i){t=="bottom"?i=="w-to-e"?n.selectAll("text").attr("transform","rotate(0)").attr("x","0").attr("y","10").style("text-anchor","middle"):i=="nw-to-se"?n.selectAll("text").attr("transform","rotate(45)").attr("x","0").attr("y","10").style("text-anchor","start"):i=="n-to-s"?n.selectAll("text").attr("transform","rotate(90)").attr("x","10").attr("y","-5").style("text-anchor","start"):i=="ne-to-sw"?n.selectAll("text").attr("transform","rotate(135)").attr("x","10").attr("y","-5").style("text-anchor","start"):i=="e-to-w"?n.selectAll("text").attr("transform","rotate(180)").attr("x","0").attr("y","-20").style("text-anchor","middle"):i=="se-to-nw"?n.selectAll("text").attr("transform","rotate(225)").attr("x","-7").attr("y","-10").style("text-anchor","end"):i=="s-to-n"?n.selectAll("text").attr("transform","rotate(270)").attr("x","-15").attr("y","-3").style("text-anchor","end"):i=="sw-to-ne"&&n.selectAll("text").attr("transform","rotate(315)").attr("x","-7").attr("y","0").style("text-anchor","end"):t=="left"&&(i=="w-to-e"?n.selectAll("text").attr("transform","rotate(0)").attr("x","-10").attr("y","0").style("text-anchor","end"):i=="nw-to-se"?n.selectAll("text").attr("transform","rotate(45)").attr("x","-7").attr("y","7").style("text-anchor","end"):i=="n-to-s"?n.selectAll("text").attr("transform","rotate(90)").attr("x","0").attr("y","15").style("text-anchor","middle"):i=="ne-to-sw"?n.selectAll("text").attr("transform","rotate(135)").attr("x","7").attr("y","5").style("text-anchor","start"):i=="e-to-w"?n.selectAll("text").attr("transform","rotate(180)").attr("x","7").attr("y","0").style("text-anchor","start"):i=="se-to-nw"?n.selectAll("text").attr("transform","rotate(225)").attr("x","7").attr("y","-7").style("text-anchor","start"):i=="s-to-n"?n.selectAll("text").attr("transform","rotate(270)").attr("x","0").attr("y","-17").style("text-anchor","middle"):i=="sw-to-ne"&&n.selectAll("text").attr("transform","rotate(315)").attr("x","-7").attr("y","-7").style("text-anchor","end"))},_set_legend:function(n){var t=n.param,f=n.legendHolder,u=n.keys,o=n.colorScale,r=7,i=(t.scale.width+t.scale.height)/50+r,s=t.scale.legend.width,e=f.append("g").attr("class","v-legend v-text-noselect").style("font-size",7+i/9).style("text-anchor","end").attr("transform",function(){let n="translate(0, 0)";if(t.pattern.legend.position=="ne"&&t.pattern.legend.orientation=="vertical"&&(t.pattern.type=="pie"||t.pattern.type=="doughnut")){let t=f.attr("transform").replace("translate(","").replace(")","").split(",");n="translate("+-1*(parseInt(t[0])-40)+","+-1*(parseInt(t[1])+10)+")"}return n}).selectAll("g").data(function(){var n=sn.visual._core_lib._pattern_types._isAxisBasedVisual(t.pattern.type)&&(t.pattern.legend.position=="ne"&&t.pattern.legend.orientation=="horizontal"||t.pattern.legend.position=="e"&&t.pattern.legend.orientation=="vertical"||t.pattern.legend.position=="se"&&t.pattern.legend.orientation=="horizontal"||t.pattern.legend.position=="se"&&t.pattern.legend.orientation=="vertical");return n==!0?u.reverse():u}).enter().append("g").attr("transform",function(n,e){if(t.pattern.legend.position=="nw"){if(t.pattern.legend.orientation=="horizontal")return"translate("+(-1*t.scale.width+e*100)+","+(i-r)+")"}else if(t.pattern.legend.position=="n"){if(t.pattern.legend.orientation=="horizontal")return"translate("+(-1*(t.scale.width-u.length*100)+e*100)+","+i+")"}else if(t.pattern.legend.position=="ne"){if(t.pattern.legend.orientation=="horizontal")return"translate("+-e*100+","+(i-r)+")";if(t.pattern.legend.orientation=="vertical"){if(t.pattern.type=="pie"||t.pattern.type=="doughnut")return"translate(0, "+e*11+")";if(t.pattern.type=="bubble")return`translate(0, ${e*11})`;if(t.pattern.type=="line")return`translate(0, ${e*11})`;let n=f.attr("transform").replace("translate(","").replace(")","").split(",");return"translate("+-1*(parseInt(n[0])-t.scale.margin)+","+-1*(e-1)*(parseInt(n[1])-11)+")"}}else if(t.pattern.legend.position=="e"){if(t.pattern.legend.orientation=="vertical")return"translate(0,"+(t.scale.height/2-(e+1)*i)+")"}else if(t.pattern.legend.position=="se"){if(t.pattern.legend.orientation=="horizontal")return"translate("+-e*100+","+(t.scale.height+70)+")";if(t.pattern.legend.orientation=="vertical")return"translate(0,"+(t.scale.height-(e+1)*i)+")"}else if(t.pattern.legend.position=="s"){if(t.pattern.legend.orientation=="horizontal")return"translate("+(-1*(t.scale.width-u.length*100)+e*100)+","+(t.scale.height+70)+")"}else if(t.pattern.legend.position=="sw"){if(t.pattern.legend.orientation=="horizontal")return"translate("+(-1*t.scale.width+e*100)+","+(t.scale.height+70)+")"}else if(t.pattern.legend.position=="w"&&t.pattern.legend.orientation=="vertical")return"translate("+(-1*t.scale.width-t.scale.margin)+","+((t.scale.height-u.length*i)/2+(e+1)*i)+")";return console.warn("sn.visual: Legend position "+t.pattern.legend.position+" orientation "+t.pattern.legend.orientation+" is not yet implemented."),"translate(-"+t.scale.height+", -"+t.scale.width+")"});t.pattern.legend.shape=="rect"?e.append("rect").attr("class","ve-default").attr("x",t.scale.width+t.scale.margin+this._getLegendWidth(t)-(i+r/10)).attr("y",(i+r)/2+r-5).attr("width",9).attr("height",9).style("fill",function(n,t){return o(t)}):t.pattern.legend.shape=="circle"&&e.append("circle").attr("class","ve-default").attr("cx",function(){return t.scale.width+t.scale.margin+sn.visual._core_lib._getLegendWidth(t)-(i+r/10)}).attr("cy",function(){return(i+r)/2+r}).attr("r",5).style("fill",function(n,t){return o(t)});e.append("text").attr("x",t.scale.width+t.scale.margin+this._getLegendWidth(t)-(i+r)).attr("y",(i+r)/2+r/.75).attr("text-anchor","end").text(function(n){return n})},_define_visual_bar_element_shadow:function(n){var r=n.visual,u=r.append("defs"),t=u.append("filter").attr("id","drop-shadow"),i;t.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blur");t.append("feOffset").attr("in","blur").attr("dx",1).attr("dy",-1).attr("result","offsetBlur");i=t.append("feMerge");i.append("feMergeNode").attr("in","offsetBlur");i.append("feMergeNode").attr("in","SourceGraphic")},_reset_current_selection_state:function(){d3.selectAll(".ve-active").classed("ve-active",!1);d3.selectAll(".ve-inactive").classed("ve-inactive",!1)},_set_new_selection_state:function(n){var t=n;d3.selectAll(".ve-default").classed("ve-inactive",!0);d3.selectAll("#"+t).classed("ve-active",!0)},_get_draw_visual_routine:function(n,t){var i=null;return n=="bar"?t=="vertical"?i=this._draw_visual_bar_vertical:t=="horizontal"&&(i=this._draw_visual_bar_horizontal):n=="bar-grouped"?t=="vertical"&&(i=this._draw_visual_bar_grouped_vertical):n=="line"||n=="curve-line"?t=="vertical"?i=this._draw_visual_line_vertical:t=="horizontal"&&console.info("sn.visual: !!! Visual 'line-horizontal' is yet to be implemented !!!"):n=="bubble"?t=="vertical"?i=this._draw_visual_bubble_vertical:t=="horizontal"&&console.info("sn.visual: !!! Visual 'bubble-horizontal' is yet to be implemented !!!"):n=="pie"||n=="doughnut"?i=this._draw_visual_pie_doughnut:n=="table"?i=this._draw_visual_table_vertical:n=="check-list"&&(i=this._draw_visual_check_list_vertical),i},_refresh_children:function(n,t){n.forEach(function(i){var f=sn.visual._core_lib._get_draw_visual_routine(i.param.pattern.type,i.param.pattern.orientation),o=i.param.pattern.dataKey.baseAxis.key,s=i.param.pattern.dataKey.plotAxis.key,u=[],e;const r=i.param.pattern.dataKey.baseAxis.dataSourceKey;t.forEach(function(n){let t;_isNotNullOrEmpty(n[r])?t=n[r]:_isNotNullOrEmpty(n.data[r])&&(t=n.data[r]);t.forEach(function(n){u.push(n)})});e=sn.visual._model.findIndex(t=>"visual"+t._id==n[0]["parent-visual-id"]);i.param._data=sn.visual.helper.reduceSelectedAll(i.param,u);i.param.pattern.dataKey.plotAxis.colors=i.param.option.suppress.randomColors==!0?sn.visual._core_lib._get_colors_of_scheme(i.param.option.colorScheme||sn.visual.default.param.option.colorScheme):sn.visual._core_lib._get_colors_random(i.param.option.colorScheme||sn.visual.default.param.option.colorScheme,i.param._data.length);d3.selectAll("#"+i["visual-id"]+" > *").remove();f(i);i.param.children!=null&&i.param.children.length>0&&(this.childVisualsToRefresh=sn.visual._model.filter(n=>n["parent-visual-id"]==i["visual-id"]),sn.visual._core_lib._refresh_children(this.childVisualsToRefresh,u))})},_sort_raw_data:function(n){var r=this._get_all_base_keys(n),t="",i="";r.forEach(function(n){t+=`sck_1['${n}'] + `});t+=' ""';i=t.replace(/sck_1/g,"sck_2");n.dataSource.data=n.dataSource.data.sort(function(){return d3.ascending(eval(t),eval(i))})},_internal_traverse_to_transform:function(n,t,i){var u,r;if(n){let f=i.findIndex(i=>i[n.pattern.dataKey.baseAxis.key]==t[n.pattern.dataKey.baseAxis.key]);if(f==-1){let r={};r[n.pattern.dataKey.baseAxis.key]=t[n.pattern.dataKey.baseAxis.key];r[n.pattern.dataKey.plotAxis.key]=t[n.pattern.dataKey.plotAxis.valueKey];_isNotNullOrEmpty(n.pattern.dataKey.baseAxis.moreKey)==!0&&n.pattern.dataKey.baseAxis.moreKey.forEach(function(n){r[n.key]=t[n.key]});i.push(r);f=i.length-1}else i[f][n.pattern.dataKey.plotAxis.key]+=t[n.pattern.dataKey.plotAxis.valueKey]==null?0:t[n.pattern.dataKey.plotAxis.valueKey];if(n.children)for(u=0;u<n.children.length;u++)if(child=n.children[u],_isNotNullOrEmpty(child.pattern.dataKey.baseAxis.dataSourceKey))i[f][child.pattern.dataKey.baseAxis.dataSourceKey]==null&&(i[f][child.pattern.dataKey.baseAxis.dataSourceKey]=[]),this._internal_traverse_to_transform(child,t,i[f][child.pattern.dataKey.baseAxis.dataSourceKey]);else if(_isNotNullOrEmpty(child.pattern.dataKey.baseAxis.groupKey)){i[f][child.pattern.dataKey.baseAxis.groupKey]==null&&(i[f][child.pattern.dataKey.baseAxis.groupKey]=[]);let n=i[f][child.pattern.dataKey.baseAxis.groupKey],u=child.pattern.dataKey.baseAxis.groupElementKey,e=child.pattern.dataKey.plotAxis.valueKey;for(r=0;r<u.length;r++){let i=n.findIndex(n=>n.key==t[u[r]]);if(i<0){let f={};f.key=t[u[r]];f.value=0;n.push(f);i=n.length-1}n[i].value+=typeof t[e[r]]=="number"?t[e[r]]:0}}}},_transform_rawdata_to_data:function(n){this.transform_success;try{let r=n.dataSource.data;for(var i=[],t=0;t<r.length;)this._internal_traverse_to_transform(n,r[t],i),t++;n.data=i;this.transform_success=!0}catch(r){this.transform_success=!1;console.error(r.message)}return this.transform_success},_get_all_base_keys:function(n){var t=[];return n&&(t.push(n.pattern.dataKey.baseAxis.key),n.children&&n.children.forEach(function(n){sn.visual._core_lib._get_all_base_keys(n).forEach(function(n){t.indexOf(n)<0&&t.push(n)})})),t},_is_group_key_one_of_data_source_key:function(n){let t;if(_isNotNullOrEmpty(n.pattern.dataKey.baseAxis.groupKey)&&n.children.length>0){t=!1;for(var i=0;i<n.children.length;i++)if(this._is_group_key_one_of_data_source_key(n.children[i])==!0&&n.pattern.dataKey.baseAxis.groupKey==n.children[i].pattern.dataKey.baseAxis.dataSourceKey){t=!0;break}}else t=!0;return t},_get_visual_ground_created:function(n,t){var i=sn.visual.helper.getUniqueId(),r,u,c,f,s,e;n.pattern.type=="check-list"&&(n.scale.width=75,n.scale.height=150,n.scale.margin=2,n.scale.padding=2);r=this._get_visual_holder_size(n);let h=function(){if(d3.selectAll("#"+_get.id.titleContainer(i)+" > *").remove(),_get.d3.holder(i).classed("vh-full")==!0){_get.d3.titleContainer(i).attr("style",_emptyStr);let t=_get.d3.titleContainer(i).append("div").html(` <table class="v-text-noselect" style="z-order: 9999999;">
                                <tr>
                                <td id="${_get.id.resizeSmall(i)}_1" title="Restore back to normal size"><span class="fa fa-angle-left" style="color:gray;"></span></td>
                                <td id="${_get.id.resizeSmall(i)}_2" title="Restore back to normal size" style="font-size: x-small; opacity: 0.5;">&nbsp;Back</td>
                                <td>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                <td class="v-head-text-holder" style="font-size: small; font-weight:800;">${n.basic.title}</td>
                                </tr>
                                </table>
                        `);t.selectAll("#"+_get.id.resizeSmall(i)+"_1").on("click",function(){o()});t.selectAll("#"+_get.id.resizeSmall(i)+"_2").on("click",function(){o()});f.style("background-color",n.scale.tile.backgroundColor).style("color",sn.visual._core_lib._get_color_readable(n.scale.tile.backgroundColor))}else{f.style("background-color",_get.d3.holder(i).style("border-color")).style("margin","-"+n.scale.tile.padding+"px").style("border","1px solid "+_get.d3.holder(i).style("background-color")).style("padding","2px").style("border-radius",_get.d3.holder(i).style("border-radius")).style("font-size","x-small").style("font-weight","900");let t=_get.d3.titleContainer(i).append("div").attr("id",_get.id.title(i));t.attr("class","vv-text-title v-text-noselect v-text-overflow-hide").style("width",r.width-50+"px").style("float","left").on("mouseenter",function(){_set.element.text_as_title(t.attr("id"))}).text(n.basic.title);_set.element.text_as_title(t.attr("id"));_get.d3.titleContainer(i).style("height",n.scale.tile.headerBarHeight+"px").style("float","left").style("width",r.width-50+"px");f.style("color",sn.visual._core_lib._get_color_readable(_get.d3.titleContainer(i).style("background-color")))}},o=function(){d3.selectAll("#"+_get.id.visual(i)+" > *").remove();_get.d3.holder(i).classed("vh-full")==!1?(n.scale._prev_width=n.scale.width,n.scale._prev_height=n.scale.height,n.scale.width=window.innerWidth-window.innerWidth*.25,n.scale.height=window.innerHeight-window.innerHeight*.25,_get.d3.resizeFull(i).style("display","none"),_get.d3.holder(i).style("z-index",sn.visual.default.maxZIndex).classed("vh-full",!0),window.onresize=function(){_get.d3.holder(i).style("width",window.innerWidth+"px").style("height",window.innerHeight+"px")}):(n.scale.width=n.scale._prev_width!=null?n.scale._prev_width:sn.visual.default.param.scale.width,n.scale.height=n.scale._prev_height!=null?n.scale._prev_height:sn.visual.default.param.scale.height,_get.d3.resizeFull(i).classed("fa-window-maximize",!0).classed("fa-window-restore",!1).attr("title","Resize to full").style("display","block"),_get.d3.holder(i).classed("vh-full",!1),window.onresize=null);r=sn.visual._core_lib._get_visual_holder_size(n);_get.d3.holder(i).classed("vh-full")==!0?u.style("width",window.innerWidth+"px").style("height",window.innerHeight+"px").style("top","-5px").style("left","-5px"):(u.style("width",r.width+"px").style("height",r.height+"px").style("top",(window.innerHeight-r.height)/2+"px").style("left",(window.innerWidth-r.width)/2+"px"),_get.d3.title(i).style("width",r.width-30+"px"));h();t(e);_get.d3.visual(i).style("width",r.width-2*n.scale.tile.padding-2*n.scale.tile.padding+"px").style("height",r.height+(_get.d3.holder(i).classed("vh-full")?n.scale.margin:0)-2*n.scale.tile.margin-2*n.scale.tile.padding+"px");sn.visual._core_lib._pattern_types._isVisualChartType(n.pattern.type)&&sn.visual._core_lib._decorate_visual_based_on_option(e)};d3.select(n.holder.elementSelector).append("a").attr("name",_get.id.holder(i));u=d3.select(n.holder.elementSelector).append("div").attr("id",_get.id.holder(i)).attr("class","vh-default").style("width",r.width+"px").style("height",r.height+"px").style("margin",n.scale.tile.margin+"px").style("padding",n.scale.tile.padding+"px").style("background-color",n.scale.tile.backgroundColor);_get.d3.holder(i).style("border-color",n.scale.tile.hostColor);c=u.append("div").attr("id",_get.id.tooltip(i)).attr("class","ve-tooltip-compact");f=u.append("div").attr("id",_get.id.header(i));f.append("div").attr("id",_get.id.titleContainer(i));_get.d3.header(i).style("height",n.scale.tile.headerBarHeight+"px");n.option.suppress.tileHeader==!1&&h();s=n.pattern.type=="table"||n.pattern.type=="check-list"?u.append("div"):u.append("svg");s.attr("id",_get.id.visual(i)).style("width",sn.visual._core_lib._get_visual_size(n).width+"px").style("height",sn.visual._core_lib._get_visual_size(n).height+"px").on("click",function(){this==d3.event.target&&sn.visual._core_lib._reset_current_selection_state()});if(e={_id:i,"visual-holder":u,"visual-header":f,"visual-tooltip":c,visual:s,param:n},n.listener&&n.listener.onExpandClick)let t=f.append("span").attr("id","expand_"+i).attr("title","Expand").attr("class","fa fa-external-link").attr("style","float: right; opacity: 0.7; padding: 5px; margin: -2px; top: -2px; cursor: pointer;").style("color",_get.d3.header(i).style("color")).on("click",function(){n.listener.onExpandClick()});if(n.option.suppress.toolBar!=!0)f.append("span").attr("id",_get.id.resizeFull(i)).attr("title","Resize to full").attr("class","fa fa-window-maximize").attr("style","float: right; opacity: 0.7; padding: 5px; margin: -2px; top: -2px; cursor: pointer;").style("color",_get.d3.header(i).style("color")).on("click",function(){o()});return sn.visual._core_lib._pattern_types._isVisualChartType(n.pattern.type)&&sn.visual._core_lib._decorate_visual_based_on_option(e),e},_decorate_visual_based_on_option:function(n){var t=n.param,r=n.visual,i=n["visual-holder"],u=n["visual-header"];t.option.suppress.visualBorder==!1&&r.style("border","1px dashed lightblue");i.classed("vh-invisible",t.option.suppress.tileBorder==!0);t.option.suppress.tileHeader==!0&&(r.append("text").attr("x",2*t.scale.margin+(t.scale.width-2*t.scale.margin)/2).attr("y",t.scale.margin/1.5).attr("class","vv-text-title v-text-noselect").text(t.basic.title),u.style("background-color",i.attr("background-color")).style("color",i.attr("background-color")))},_visual_element_click_handling:function(n){if(_switch_selection=function(n,t){this.group=d3.select("#"+n+" .ve-inter-group-default");this.group.selectAll(".ve-inter-default").classed("ve-inter-unselected",t==!1);this.group.selectAll(".ve-inter-default").classed("ve-inter-selected",t==!0)},_invoke_child_visuals=function(n){this.visualsToRefresh=sn.visual._model.filter(t=>t["parent-visual-id"]==n);this.group=d3.select("#"+n+" .ve-inter-group-default");var t=[],i;i=this.group.selectAll(".ve-inter-default").filter(".ve-inter-unselected").size()==0?this.group.selectAll(".ve-inter-default"):this.group.selectAll(".ve-inter-default").filter(".ve-inter-selected");i.each(function(n){t.push(n)});sn.visual._core_lib._refresh_children(this.visualsToRefresh,t)},_get.is_visual_interactable(n.param)&&(this.group=d3.select("#"+n.visualId+" .ve-inter-group-default"),d3.select(n["this"]).classed("ve-inter-selected")==!0&&this.group.selectAll(".ve-inter-selected").size()==1?_switch_selection(d3.select(n["this"]).attr("data-visual-id"),!0):d3.event.ctrlKey==!0?(d3.select(n["this"]).classed("ve-inter-selected",d3.select(n["this"]).classed("ve-inter-selected")==!0?!1:!0),d3.select(n["this"]).classed("ve-inter-unselected",d3.select(n["this"]).classed("ve-inter-selected")==!1)):(_switch_selection(d3.select(n["this"]).attr("data-visual-id"),!1),d3.select(n["this"]).classed("ve-inter-selected",!0)),_invoke_child_visuals(d3.select(n["this"]).attr("data-visual-id"))),n.param.listener&&n.param.listener.onVisualElementClick){let t={selected:[]};try{if(this.group){let r,i;this.group.selectAll(".ve-inter-default").filter(".ve-inter-selected").each(function(u){r=_isNotNullOrEmpty(u.data)?u.data:u;i=_get.json_cloned(r);delete i._id;i.key=_isNullOrEmpty(i.key)?r[n.param.pattern.dataKey.baseAxis.key]:i.key;i.value=_isNullOrEmpty(i.value)?r[n.param.pattern.dataKey.plotAxis.key]:i.value;t.selected.push(i)})}}catch(t){(t.message||t.stack)&&console.error(t.message+t.stack)}n.param.listener.onVisualElementClick(t)}},_visual_element_mousemove_handling:function(n){let r=n.visualToolTip,u=n.colorScale,t=n.param.pattern.dataKey.baseAxis.key,i=n.param.pattern.dataKey.plotAxis.key,s=n.ttDistance,e=n.id,f=_get.d3.holder(e).classed("vh-full");var h=sn.visual.helper.getMouseAtContext(n.visual.attr("id")),o=document.getElementById(r.attr("id")).getBoundingClientRect();r.html(`<label class="ve-inner-left-tooltip" style='background-color: ${u(n.i)}; color: ${sn.visual._core_lib._get_color_readable(u(n.i))};'>${n.d[t]!=null?n.d[t]:n.d.data[t]!=null?n.d.data[t]:""}</label>&nbsp;<label class="ve-inner-right-tooltip">${n.d[i]!=null?n.d[i]:n.d.data[i]!=null?n.d.data[i]:""}</label>`).style("left",function(){return(f?d3.event.offsetX:d3.event.layerX)+20+"px"}).style("top",function(){return(f?d3.event.offsetY:d3.event.layerY)-o.height+"px"}).transition().duration(1500).style("display","block")},_draw_visual_bar_horizontal:function(n){function p(){return t.scale.width<=100||t.scale.height<=100}function u(){return p()?9:_get.d3.holder(n._id).classed("vh-full")?12:9}function h(){return p()?9:_get.d3.holder(n._id).classed("vh-full")?14:12}var s=n.visual,tt=n["visual-holder"],v=n["visual-tooltip"],t=n.param,k,d,e,o,g,nt;_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").size()>0?_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").text(t.basic.title):_get.d3.title(`${n._id}`).text(t.basic.title);let y=sn.visual.default.zeroPlotValue,b=t.pattern.dataKey.plotAxis.moreKey&&t.pattern.dataKey.plotAxis.moreKey.length>0;k=t.pattern.dataKey.baseAxis.key;d=t.pattern.dataKey.plotAxis.key;t.option.suppress.elementShadow==!1&&sn.visual._core_lib._define_visual_bar_element_shadow(n);var i=d3.scaleBand().range([t.scale.height,t.scale.margin]).padding(.4),r=d3.scaleLinear().range([t.scale.margin+1,t.scale.width]),c=d3.scaleOrdinal().range(t.pattern.dataKey.plotAxis.colors),f=s.append("g").attr("class","ve-inter-group-default").attr("transform","translate("+t.scale.margin*1+",0)");i.domain(t._data.map(function(){return eval('d["'+t.pattern.dataKey.baseAxis.key+'"]')}));r.domain([0,d3.max(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')})]).nice();e=f.append("g").attr("transform","translate(1, 0)").attr("class","va-text-baseaxis v-text-noselect").style("font-size",u()+"px").style("cursor","default").style("fill-opacity","1").call(d3.axisLeft(i).tickFormat(function(n){return(t.pattern.dataKey.baseAxis.prefix!=null?t.pattern.dataKey.baseAxis.prefix:"")+n+(t.pattern.dataKey.baseAxis.suffix!=null?t.pattern.dataKey.baseAxis.suffix:"")}));sn.visual._core_lib._set_axis_text_direction(e,"left",t.pattern.dataKey.baseAxis.textDirection);e.on("mousemove",function(){e.transition().style("font-size",h()+"px")}).on("mouseout",function(){e.transition().style("font-size",u()+"px")});o=f.append("g").attr("transform","translate("+-1*t.scale.margin+", "+t.scale.height+")").style("font-size",u()+"px").style("cursor","default").attr("class","va-text-plotaxis v-text-noselect").call(d3.axisBottom(r).tickFormat(function(n){return(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")}));sn.visual._core_lib._set_axis_text_direction(o,"bottom",t.pattern.dataKey.plotAxis.textDirection);o.on("mousemove",function(){o.transition().style("font-size",h()+"px")}).on("mouseout",function(){o.transition().style("font-size",u()+"px")});let l=s.append("text").attr("class","va-text-baseaxis-title v-text-noselect").attr("transform","translate("+t.scale.margin/7+","+(t.scale.height+2*t.scale.margin)/2+") rotate(270)").style("font-size",u()+"px").style("cursor","default").text(t.pattern.dataKey.baseAxis.title);l.on("mousemove",function(){l.transition().style("font-size",h()+"px")}).on("mouseout",function(){l.transition().style("font-size",u()+"px")});let a=s.append("text").attr("class","va-text-plotaxis-title v-text-noselect").attr("transform","translate("+(t.scale.width+2*t.scale.margin)/2+","+(t.scale.height+1.5*t.scale.margin)+")").style("font-size",u()+"px").style("cursor","default").text(t.pattern.dataKey.plotAxis.title);a.on("mousemove",function(){a.transition().style("font-size",h()+"px")}).on("mouseout",function(){a.transition().style("font-size",u()+"px")});g=d3.min(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')});nt=d3.min(t._data,function(){return r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))});let w=!1;f.selectAll(".ve-default").data(t._data).enter().append("rect").attr("class",function(){return _get.is_visual_interactable(t)==!0?"ve-inter-default ve-default ":" ve-default "}).attr("data-visual-id",_get.id.visual(n._id)).on("click",function(){sn.visual._core_lib._visual_element_click_handling({"this":this,visualId:d3.select(this).attr("data-visual-id"),param:t})}).on("mousemove",function(u,f){w==!0&&(sn.visual._core_lib._visual_element_mousemove_handling({d:u,i:f,ttDistance:i.bandwidth()/3,colorScale:c,visual:s,visualToolTip:v,param:t,id:n._id}),d3.select(this).transition().style("height",i.bandwidth()+2+"px").style("width",r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-t.scale.margin+2+"px").style("y",i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-1+"px"))}).on("mouseout",function(){v.style("display","none");d3.select(this).transition().style("height",i.bandwidth()-2+"px").style("width",r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-t.scale.margin-2+"px").style("y",i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+1+"px")}).style("fill",function(n,t){return c(t)}).classed("ve-default-if-zero",function(n){return n[t.pattern.dataKey.plotAxis.key]<=0}).attr("x",2).attr("y",function(){return i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))}).attr("height",i.bandwidth()).attr("width",function(){return 0}).transition().duration(t.option.suppress.transition==!1?1500:0).attr("width",function(){return r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-t.scale.margin}).on("end",function(){w=!0});f.selectAll(".ve-text-default").data(t._data).enter().append("text").attr("class","ve-text-default v-text-noselect").style("fill",function(n,u){return r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-t.scale.margin<i.bandwidth()?"black":sn.visual._core_lib._get_color_readable(c(u))}).style("text-anchor","end").style("font-size",function(){return Math.round(i.bandwidth()/10,0)*5+"px"}).text(function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')}).attr("x",function(){return this.getComputedTextLength()}).attr("y",function(){return i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+i.bandwidth()/1.5}).on("mousemove",function(){d3.select(this).transition().style("font-size",Math.round(i.bandwidth()/10,0)*5+4+"px").attr("y",function(){return i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+i.bandwidth()/1.35})}).on("mouseout",function(){d3.select(this).transition().style("font-size",Math.round(i.bandwidth()/10,0)*5+"px").attr("y",function(){return i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+i.bandwidth()/1.5})}).style("opacity","0").transition().duration(t.option.suppress.transition==!1?1500:0).attr("x",function(){return r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-t.scale.margin<i.bandwidth()?r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+i.bandwidth()/2:r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-t.scale.margin-i.bandwidth()/4}).style("opacity","1");b&&(f.selectAll(".ve-default-1").data(t._data).enter().append("circle").attr("class","ve-default-1").attr("id",function(n){return n._id}).style("fill",function(){return"#FFFFFF"}).style("opacity",0).attr("cx",function(){return i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin+i.bandwidth()/2}).attr("cy",function(){return r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+i.bandwidth()/2+(t.option.suppress.transition==!1?t.scale.height-r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')):0)}).attr("r",function(){return i.bandwidth()/2}).transition().duration(t.option.suppress.transition==!1?1500:0).style("opacity",1).attr("cx",function(){return i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+i.bandwidth()/2-t.scale.margin}).attr("cy",function(n){return r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-(n[t.pattern.dataKey.plotAxis.key]<=0?y.elementSize+1:0)}).attr("r",function(){return i.bandwidth()/2}),f.selectAll(".ve-text-default-1").data(t._data).enter().append("text").text(function(){return eval('d["'+(t.pattern.dataKey.plotAxis.moreKey&&t.pattern.dataKey.plotAxis.moreKey.length>0?t.pattern.dataKey.plotAxis.moreKey[0]:t.pattern.dataKey.plotAxis.key)+'"]')}).attr("class","ve-text-default v-text-noselect").style("font-size",function(){return Math.round(i.bandwidth()/10,0)*3+"px"}).style("fill",function(){return"#000000"}).attr("x",function(){return i(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+i.bandwidth()/2-t.scale.margin}).attr("y",function(){return t.option.suppress.transition==!1?r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+(t.scale.height-r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))):r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+i.bandwidth()/2}).style("opacity",t.option.suppress.transition==!1?"0":"1").transition().duration(t.option.suppress.transition==!1?1500:0).attr("y",function(n){return r(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+i.bandwidth()/9-(n[t.pattern.dataKey.plotAxis.key]<=0?y.elementSize+1:0)}).style("opacity","1"));f.selectAll("rect").each(function(){t.option.suppress.elementShadow==!1&&d3.select(this).attr("stroke-width",1).style("filter","url(#drop-shadow)")});t.option.suppress.legend!=!0&&sn.visual._core_lib._set_legend({param:t,legendHolder:f,keys:sn.visual.helper.getLegendValues(t),colorScale:c})},_draw_visual_bar_vertical:function(n){function k(){return t.scale.width<=100||t.scale.height<=100}function e(){return k()?9:_get.d3.holder(n._id).classed("vh-full")?12:9}function a(){return k()?9:_get.d3.holder(n._id).classed("vh-full")?14:12}var l=n.visual,ut=n["visual-holder"],w=n["visual-tooltip"],t=n.param,nt,tt,h,s,c,it,rt;_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").size()>0?_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").text(t.basic.title):_get.d3.title(`${n._id}`).text(t.basic.title);let o=sn.visual.default.zeroPlotValue,b=t.pattern.dataKey.plotAxis.moreKey&&t.pattern.dataKey.plotAxis.moreKey.length>0;nt=t.pattern.dataKey.baseAxis.key;tt=t.pattern.dataKey.plotAxis.key;t.option.suppress.elementShadow==!1&&sn.visual._core_lib._define_visual_bar_element_shadow(n);var r=d3.scaleBand().range([t.scale.margin+1,t.scale.width+3*t.scale.margin]).padding(.4),u=d3.scaleLinear().range([t.scale.height+t.scale.margin,t.scale.margin/2]),v=d3.scaleOrdinal().range(t.pattern.dataKey.plotAxis.colors),f=l.append("g").attr("class","ve-inter-group-default").attr("transform","translate("+t.scale.margin*1+", 0)"),d=d3.max(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')});r.domain(t._data.map(function(){return eval('d["'+t.pattern.dataKey.baseAxis.key+'"]')}));u.domain([0,d]).nice();h=f.append("g").attr("transform","translate("+-1*t.scale.margin+", "+(t.scale.height+t.scale.margin)+")").style("font-size",e()+"px").style("cursor","default").attr("class","va-text-plotaxis v-text-noselect").call(d3.axisBottom(r).tickFormat(function(n){return(t.pattern.dataKey.baseAxis.prefix!=null?t.pattern.dataKey.baseAxis.prefix:"")+n+(t.pattern.dataKey.baseAxis.suffix!=null?t.pattern.dataKey.baseAxis.suffix:"")}));sn.visual._core_lib._set_axis_text_direction(h,"bottom",t.pattern.dataKey.baseAxis.textDirection);h.on("mousemove",function(){h.transition().style("font-size",a()+"px")}).on("mouseout",function(){h.transition().style("font-size",e()+"px")});t.pattern.dataKey.plotAxis.tickStyle=="auto"?s=f.append("g").attr("transform","translate(1, 0)").style("font-size",e()+"px").style("cursor","default").attr("class","va-text-baseaxis v-text-noselect").call(d3.axisLeft(u).tickFormat(function(n){return(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")})):(c=d3.axisLeft(u),t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"?t.option.suppress.blankTicks==!1?c.tickFormat(function(n){return t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"&&(n.toString().indexOf(".")>=0||n%t.pattern.dataKey.plotAxis.tickIncrement!=0)?"":(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")}):c.tickFormat(d3.format(".0f")).tickValues(d3.range(0,d+1,t.pattern.dataKey.plotAxis.tickIncrement)):t.pattern.dataKey.plotAxis.tickStyle=="blank"&&c.tickValues(d3.range(0,0,0)),s=f.append("g").attr("transform","translate(1, 0)").call(c));sn.visual._core_lib._set_axis_text_direction(s,"left",t.pattern.dataKey.plotAxis.textDirection);s.on("mousemove",function(){s.transition().style("font-size",a()+"px")}).on("mouseout",function(){s.transition().style("font-size",e()+"px")});let y=l.append("text").attr("class","va-text-plotaxis v-text-noselect").attr("transform","translate("+t.scale.margin/3+","+(t.scale.height+2*t.scale.margin)/2+") rotate(270)").style("font-size",e()+"px").style("cursor","default").text(t.pattern.dataKey.plotAxis.title);y.on("mousemove",function(){y.transition().style("font-size",a()+"px")}).on("mouseout",function(){y.transition().style("font-size",e()+"px")});let p=l.append("text").attr("class","va-text-baseaxis v-text-noselect").attr("transform","translate("+(t.scale.margin+(t.scale.width+t.scale.margin)/2)+","+(t.scale.height+(_get.d3.holder(n._id).classed("vh-full")?3:1.75)*t.scale.margin)+")").style("font-size",e()+"px").style("cursor","default").text(t.pattern.dataKey.baseAxis.title);p.on("mousemove",function(){p.transition().style("font-size",a()+"px")}).on("mouseout",function(){p.transition().style("font-size",e()+"px")});it=d3.min(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')});rt=d3.min(t._data,function(){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))});let i={get_baseScale_bandwidth:function(){const t=_get.d3.holder(n._id).classed("vh-full")?50:20;return r.bandwidth()>t?t:r.bandwidth()},get_rect_height:function(n){let i=t.scale.height+t.scale.margin-u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'));return n[t.pattern.dataKey.plotAxis.key]<=0?o.elementSize:i},get_rect_y:function(n){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-(n[t.pattern.dataKey.plotAxis.key]<=0?o.elementSize+1:0)},get_text_y:function(n){return b?u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+(i.get_baseScale_bandwidth()-i.get_baseScale_bandwidth()/10):i.get_rect_height(n)<i.get_baseScale_bandwidth()?u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')==0?i.get_baseScale_bandwidth()/8:0):u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+i.get_baseScale_bandwidth()/2}},g=!1;f.selectAll(".ve-default").data(t._data).enter().append("rect").attr("class",function(){return _get.is_visual_interactable(t)==!0?"ve-inter-default ve-default ":" ve-default "}).attr("data-visual-id",_get.id.visual(n._id)).on("click",function(){sn.visual._core_lib._visual_element_click_handling({"this":this,visualId:d3.select(this).attr("data-visual-id"),param:t})}).on("mousemove",function(u,f){g==!0&&(sn.visual._core_lib._visual_element_mousemove_handling({d:u,i:f,ttDistance:r.bandwidth()/3,colorScale:v,visual:l,visualToolTip:w,param:t,id:n._id}),d3.select(this).transition().style("width",i.get_baseScale_bandwidth()+2+"px").style("height",i.get_rect_height(u)+1+"px").style("x",r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+(r.bandwidth()-i.get_baseScale_bandwidth())/2-t.scale.margin-1+"px").style("y",i.get_rect_y(u)-1+"px"))}).on("mouseout",function(n){w.style("display","none");d3.select(this).transition().style("width",i.get_baseScale_bandwidth()+"px").style("height",i.get_rect_height(n)+"px").style("x",r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+(r.bandwidth()-i.get_baseScale_bandwidth())/2-t.scale.margin+"px").style("y",i.get_rect_y(n)+"px")}).style("fill",function(n,i){return n[t.pattern.dataKey.plotAxis.key]<=0?o.elementColor:v(i)}).classed("ve-default-if-zero",function(n){return n[t.pattern.dataKey.plotAxis.key]<=0}).attr("width",i.get_baseScale_bandwidth()).attr("x",function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+(r.bandwidth()-i.get_baseScale_bandwidth())/2-t.scale.margin}).attr("y",function(){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+(t.option.suppress.transition==!1?t.scale.height+t.scale.margin-u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')):0)}).attr("height",function(){return 0}).transition().duration(t.option.suppress.transition==!1?1500:0).attr("y",function(n){return i.get_rect_y(n)}).attr("height",function(n){return i.get_rect_height(n)}).on("end",function(){g=!0});f.selectAll(".ve-text-default").data(t._data).enter().append("text").text(function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')}).attr("class","ve-text-default v-text-noselect").style("font-size",function(){return Math.round(i.get_baseScale_bandwidth()/10,0)*3+"px"}).style("fill",function(n,r){return i.get_rect_height(n)<i.get_baseScale_bandwidth()||eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')==0?o.textColor:sn.visual._core_lib._get_color_readable(v(r))}).attr("x",function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+(r.bandwidth()-i.get_baseScale_bandwidth())/2+i.get_baseScale_bandwidth()/2-t.scale.margin}).attr("y",function(){return t.option.suppress.transition==!1?u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+(t.scale.height-u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))):u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+i.get_baseScale_bandwidth()/2}).on("mousemove",function(){d3.select(this).transition().style("font-size",Math.round(i.get_baseScale_bandwidth()/10,0)*3+4+"px").attr("y",function(n){return i.get_text_y(n)})}).on("mouseout",function(){d3.select(this).transition().style("font-size",Math.round(i.get_baseScale_bandwidth()/10,0)*3+"px").attr("y",function(n){return i.get_text_y(n)})}).style("opacity",t.option.suppress.transition==!1?"0":"1").transition().duration(t.option.suppress.transition==!1?1500:0).attr("y",function(n){return i.get_text_y(n)}).style("opacity","1");b&&(f.selectAll(".ve-default-1").data(t._data).enter().append("circle").attr("class","ve-default-1").attr("id",function(n){return n._id}).style("fill",function(){return"#FFFFFF"}).style("opacity",0).attr("cx",function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin+r.bandwidth()/2}).attr("cy",function(){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+r.bandwidth()/2+(t.option.suppress.transition==!1?t.scale.height-u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')):0)}).attr("r",function(){return r.bandwidth()/2}).transition().duration(t.option.suppress.transition==!1?1500:0).style("opacity",1).attr("cx",function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+r.bandwidth()/2-t.scale.margin}).attr("cy",function(n){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-(n[t.pattern.dataKey.plotAxis.key]<=0?o.elementSize+1:0)}).attr("r",function(){return r.bandwidth()/2}),f.selectAll(".ve-text-default-1").data(t._data).enter().append("text").text(function(){return eval('d["'+(t.pattern.dataKey.plotAxis.moreKey&&t.pattern.dataKey.plotAxis.moreKey.length>0?t.pattern.dataKey.plotAxis.moreKey[0]:t.pattern.dataKey.plotAxis.key)+'"]')}).attr("class","ve-text-default v-text-noselect").style("font-size",function(){return Math.round(r.bandwidth()/10,0)*3+"px"}).style("fill",function(){return"#000000"}).attr("x",function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))+r.bandwidth()/2-t.scale.margin}).attr("y",function(){return t.option.suppress.transition==!1?u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+(t.scale.height-u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))):u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+r.bandwidth()/2}).style("opacity",t.option.suppress.transition==!1?"0":"1").transition().duration(t.option.suppress.transition==!1?1500:0).attr("y",function(n){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))+r.bandwidth()/9-(n[t.pattern.dataKey.plotAxis.key]<=0?o.elementSize+1:0)}).style("opacity","1"));f.selectAll("rect").each(function(){t.option.suppress.elementShadow==!1&&d3.select(this).attr("stroke-width",1).style("filter","url(#drop-shadow)")});t.option.suppress.legend!=!0&&sn.visual._core_lib._set_legend({param:t,legendHolder:f,keys:sn.visual.helper.getLegendValues(t),colorScale:v})},_draw_visual_bar_grouped_vertical:function(n){function w(){return t.scale.width<=100||t.scale.height<=100}function u(){return w()?9:_get.d3.holder(n._id).classed("vh-full")?12:9}function a(){return w()?9:_get.d3.holder(n._id).classed("vh-full")?14:12}function r(){const t=_get.d3.holder(n._id).classed("vh-full")?30:20,i=_get.d3.holder(n._id).classed("vh-full")?l.bandwidth():2.5;return w()?i:l.bandwidth()>t?t:l.bandwidth()}var it=n["visual-holder"],y=n.visual,t=n.param,b,h,o,c;t.option.suppress.elementShadow==!1&&sn.visual._core_lib._define_visual_bar_element_shadow(n);_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").size()>0?_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").text(t.basic.title):_get.d3.title(`${n._id}`).text(t.basic.title);var f=d3.scaleBand().rangeRound([1,t.scale.width+t.scale.margin+t.scale.margin]).paddingInner(.2),l=d3.scaleBand().paddingInner(t.option.suppress.elementShadow==!1?.15:.1),i=d3.scaleLinear().range([t.scale.height+t.scale.margin,t.scale.margin/2]),p=d3.scaleOrdinal().range(t.pattern.dataKey.plotAxis.colors),rt=t.pattern.dataKey.baseAxis,g=t.pattern.dataKey.baseAxis.groupKey,ut=t.pattern.dataKey.plotAxis.key,e=y.append("g").attr("transform","translate("+t.scale.margin+", 0)"),nt=d3.max(t._data,function(){return d3.max(eval('d["'+t.pattern.dataKey.baseAxis.groupKey+'"]'),function(){return eval('v["value"]')})}),tt=function(){var n=[];return t._data.forEach(function(t){t[g].forEach(function(t){n.indexOf(t.key)<0&&n.push(t.key)})}),n},s=tt();f.domain(t._data.map(function(){return eval('d["'+t.pattern.dataKey.baseAxis.key+'"]')}));this.stretchGroupAxis=(t.scale.width+2*t.scale.margin)/(t.scale.width/12);l.domain(s).rangeRound([t.scale.margin-this.stretchGroupAxis,f.bandwidth()+this.stretchGroupAxis]);i.domain([0,d3.max(t._data,function(n){return d3.max(s,function(i){this.groupData=n[t.pattern.dataKey.baseAxis.groupKey];for(var r=0;r<this.groupData.length;r++)if(this.groupData[r].key==i)return this.groupData[r].value})})]).nice();b=e.append("g").selectAll("g").data(t._data).enter().append("g").attr("transform",function(){return"translate("+(f(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-1*t.scale.margin/1.75)+", 0)"});let v;b.selectAll("rect").data(function(n){return s.map(function(i){this.plotValue=null;this.groupData=n[t.pattern.dataKey.baseAxis.groupKey];for(var r=0;r<this.groupData.length;r++)if(this.groupData[r].key==i){this.plotValue=this.groupData[r].value;break}return{key:i,value:this.plotValue}})}).enter().append("rect").attr("class","ve-default").attr("x",function(n,i){if(i==0){let n=f.bandwidth()-t.data[0][t.pattern.dataKey.baseAxis.groupKey].length*(r()+2);v=n>0?n/2:0}return v+(i+0)*(r()+2)+t.scale.margin/2}).attr("y",function(n){return i(n.value)+(t.scale.height+t.scale.margin-i(n.value))}).attr("width",r()).attr("height",function(n){return t.option.suppress.transition==!1?0:t.scale.height+t.scale.margin-i(n.value)}).style("fill",function(n,t){return p(t)}).transition().duration(t.option.suppress.transition==!1?1500:0).attr("height",function(n){return t.scale.height+t.scale.margin-i(n.value)}).attr("y",function(n){return i(n.value)});b.selectAll("text").data(function(n){return s.map(function(i){this.plotValue=null;this.groupData=n[t.pattern.dataKey.baseAxis.groupKey];for(var r=0;r<this.groupData.length;r++)if(this.groupData[r].key==i){this.plotValue=this.groupData[r].value;break}return{key:i,value:this.plotValue}})}).enter().append("text").attr("class","ve-text-default v-text-noselect").style("fill",function(n,u){return n.value==0||t.scale.height-i(n.value)<r()?"black":sn.visual._core_lib._get_color_readable(p(u))}).style("text-anchor","middle").style("opacity",t.option.suppress.transition==!1?"0":"1").style("font-size",function(){return Math.round(r()/10,0)*5}).attr("x",function(n,i){if(i==0){let n=f.bandwidth()-t.data[0][t.pattern.dataKey.baseAxis.groupKey].length*(r()+2);v=n>0?n/2:0}return v+(i+0)*(r()+2)+t.scale.margin/2+r()/2}).attr("y",function(n){return i(n.value)+r()/1.5+(t.scale.height-i(n.value))}).text(function(n){return n.value}).transition().duration(t.option.suppress.transition==!1?1500:0).style("opacity","1").attr("y",function(n){return i(n.value)+r()/1.5+(n.value==0?t.scale.height+t.scale.margin-i(n.value)-r()/1.25:t.scale.height-i(n.value)<r()?-1*r()/1.25:r()/-8)});e.selectAll("rect").each(function(){t.option.suppress.elementShadow==!1&&d3.select(this).attr("stroke-width",1).style("filter","url(#drop-shadow)")});h=e.append("g").attr("transform","translate(0, "+(t.scale.height+t.scale.margin)+")").style("font-size",u()+"px").style("cursor","default").attr("class","va-text-plotaxis v-text-noselect").call(d3.axisBottom(f).tickFormat(function(n){return(t.pattern.dataKey.baseAxis.prefix!=null?t.pattern.dataKey.baseAxis.prefix:"")+n+(t.pattern.dataKey.baseAxis.suffix!=null?t.pattern.dataKey.baseAxis.suffix:"")}));sn.visual._core_lib._set_axis_text_direction(h,"bottom",t.pattern.dataKey.baseAxis.textDirection);h.on("mousemove",function(){h.transition().style("font-size",a()+"px")}).on("mouseout",function(){h.transition().style("font-size",u()+"px")});t.pattern.dataKey.plotAxis.tickStyle=="auto"?o=e.append("g").attr("transform","translate(1, 0)").style("font-size",u()+"px").style("cursor","default").attr("class","va-text-baseaxis v-text-noselect").call(d3.axisLeft(i).tickFormat(function(n){return(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")})):(c=d3.axisLeft(i),t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"?t.option.suppress.blankTicks==!1?c.tickFormat(function(n){return t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"&&(n.toString().indexOf(".")>=0||n%t.pattern.dataKey.plotAxis.tickIncrement!=0)?"":(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")}):c.tickFormat(d3.format(".0f")).tickValues(d3.range(0,nt+1,t.pattern.dataKey.plotAxis.tickIncrement)):t.pattern.dataKey.plotAxis.tickStyle=="blank"&&c.tickValues(d3.range(0,0,0)),o=e.append("g").attr("transform","translate(1, 0)").call(c));sn.visual._core_lib._set_axis_text_direction(o,"left",t.pattern.dataKey.plotAxis.textDirection);o.on("mousemove",function(){o.transition().style("font-size",a()+"px")}).on("mouseout",function(){o.transition().style("font-size",u()+"px")});let k=y.append("text").attr("class","va-text-plotaxis v-text-noselect").attr("transform","translate("+t.scale.margin/7+","+(t.scale.height+2*t.scale.margin)/2+") rotate(270)").style("font-size",u()+"px").style("cursor","default").text(t.pattern.dataKey.plotAxis.title);k.on("mousemove",function(){k.transition().style("font-size",a()+"px")}).on("mouseout",function(){k.transition().style("font-size",u()+"px")});let d=y.append("text").attr("class","va-text-baseaxis v-text-noselect").attr("transform","translate("+(t.scale.margin+(t.scale.width+t.scale.margin)/2)+","+(t.scale.height+(_get.d3.holder(n._id).classed("vh-full")?3:1.75)*t.scale.margin)+")").style("font-size",u()+"px").text(t.pattern.dataKey.baseAxis.title);d.on("mousemove",function(){d.transition().style("font-size",a()+"px")}).on("mouseout",function(){d.transition().style("font-size",u()+"px")});sn.visual._core_lib._set_legend({param:t,legendHolder:e,keys:s,colorScale:p})},_draw_visual_bubble_vertical:function(n){function nt(){return t.scale.width<=100||t.scale.height<=100}function f(){return nt()?9:_get.d3.holder(n._id).classed("vh-full")?12:9}function y(){return nt()?9:_get.d3.holder(n._id).classed("vh-full")?14:12}function a(n){n=="show"?(p.style("display","inline"),b.style("display","inline"),s.style("display","inline")):n=="hide"&&(p.style("display","none"),b.style("display","none"),s.style("display","none"))}var i=n.visual,ut=n["visual-holder"],g=n["visual-tooltip"],t=n.param,l,h,v;_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").size()>0?_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").text(t.basic.title):_get.d3.title(`${n._id}`).text(t.basic.title);t.option.suppress.elementShadow==!1&&sn.visual._core_lib._define_visual_bar_element_shadow(n);i.attr("data-mouse-in-point","0");var c=d3.scaleBand().range([t.scale.margin+1,t.scale.width+3*t.scale.margin]).padding(.4),u=d3.scaleLinear().range([t.scale.height+t.scale.margin,t.scale.margin/2]),w=d3.scaleOrdinal().range(t.pattern.dataKey.plotAxis.colors),o=i.append("g").attr("class","ve-inter-group-default").attr("transform","translate("+t.scale.margin+","+t.scale.margin/2+")"),rt=d3.max(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')});c.domain(t._data.map(function(){return eval('d["'+t.pattern.dataKey.baseAxis.key+'"]')}));u.domain([0,d3.max(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')})]).nice();l=o.append("g").attr("transform","translate("+-1*t.scale.margin+", "+(t.scale.height+t.scale.margin/2)+")").style("font-size",f()+"px").style("cursor","default").call(d3.axisBottom(c).tickFormat(function(n){return(t.pattern.dataKey.baseAxis.prefix!=null?t.pattern.dataKey.baseAxis.prefix:"")+n+(t.pattern.dataKey.baseAxis.suffix!=null?t.pattern.dataKey.baseAxis.suffix:"")}));sn.visual._core_lib._set_axis_text_direction(l,"bottom",t.pattern.dataKey.baseAxis.textDirection);l.on("mousemove",function(){l.transition().style("font-size",y()+"px")}).on("mouseout",function(){l.transition().style("font-size",f()+"px")});let p=i.append("path").style("stroke","orange").style("stroke-width",1).style("stroke-dasharray","2, 2"),b=i.append("path").style("stroke","orange").style("stroke-width",1).style("stroke-dasharray","2, 2"),s=i.append("g").attr("transform","translate(0, 0)"),tt=s.append("text").style("fill","orangered").style("font-family","Segoe UI").attr("class","v-text-noselect");tt.append("tspan").attr("id","t1").style("font-size","7px").style("font-weight","bold").style("opacity","0.5");tt.append("tspan").attr("id","t2").style("font-weight","bold").style("font-size","11px");t.pattern.dataKey.plotAxis.tickStyle=="auto"?h=o.append("g").attr("transform",`translate(1, ${-t.scale.margin/2})`).style("font-size",f()+"px").style("cursor","default").call(d3.axisLeft(u).tickFormat(function(n){return(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")})):(v=d3.axisLeft(u),t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"?t.option.suppress.blankTicks==!1?v.tickFormat(function(n){return t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"&&(n.toString().indexOf(".")>=0||n%t.pattern.dataKey.plotAxis.tickIncrement!=0)?"":(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")}):v.tickFormat(d3.format(".0f")).tickValues(d3.range(0,rt+1,t.pattern.dataKey.plotAxis.tickIncrement)):t.pattern.dataKey.plotAxis.tickStyle=="blank"&&v.tickValues(d3.range(0,0,0)),h=o.append("g").attr("transform",`translate(1, ${-t.scale.margin/2})`).call(v));sn.visual._core_lib._set_axis_text_direction(h,"left",t.pattern.dataKey.plotAxis.textDirection);h.on("mousemove",function(){h.transition().style("font-size",y()+"px")}).on("mouseout",function(){h.transition().style("font-size",f()+"px")});let k=i.append("text").attr("class","va-text-plotaxis v-text-noselect").attr("transform","translate("+t.scale.margin/4+","+(t.scale.height/2+t.scale.margin)+") rotate(270)").style("font-size",f()+"px").style("cursor","default").text(t.pattern.dataKey.plotAxis.title);k.on("mousemove",function(){k.transition().style("font-size",y()+"px")}).on("mouseout",function(){k.transition().style("font-size",f()+"px")});let d=i.append("text").attr("class","va-text-baseaxis v-text-noselect").attr("transform","translate("+(t.scale.margin+(t.scale.width+t.scale.margin)/2)+","+(t.scale.height+(_get.d3.holder(n._id).classed("vh-full")?3:1.75)*t.scale.margin)+")").text(t.pattern.dataKey.baseAxis.title);d.on("mousemove",function(){d.transition().style("font-size",y()+"px")}).on("mouseout",function(){d.transition().style("font-size",f()+"px")});let e=(t.scale.width+t.scale.height)/100,r=d3.entries(t._data).sort(function(n,i){return d3.ascending(n.value[t.pattern.dataKey.plotAxis.key],i.value[t.pattern.dataKey.plotAxis.key])})[0].value[t.pattern.dataKey.plotAxis.key];if(r==0){let n=d3.entries(t._data).sort(function(n,i){return d3.descending(n.value[t.pattern.dataKey.plotAxis.key],i.value[t.pattern.dataKey.plotAxis.key])})[0].value[t.pattern.dataKey.plotAxis.key];r=(r+n)/2}let it=!1;o.selectAll(".ve-default").data(t._data).enter().append("circle").attr("class",function(){return _get.is_visual_interactable(t)==!0?"ve-inter-default ve-default ":" ve-default "}).attr("data-visual-id",_get.id.visual(n._id)).on("click",function(){sn.visual._core_lib._visual_element_click_handling({"this":this,visualId:d3.select(this).attr("data-visual-id"),param:t})}).on("mousemove",function(u,f){it==!0&&(a("hide"),i.attr("data-mouse-in-point",1),sn.visual._core_lib._visual_element_mousemove_handling({d:u,i:f,ttDistance:c.bandwidth()/3,colorScale:w,visual:i,visualToolTip:g,param:t,id:n._id}),d3.select(this).attr("r",e+eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')/r+2))}).on("mouseout",function(){g.style("display","none");d3.select(this).attr("r",e+eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')/r-2);a("show");i.attr("data-mouse-in-point",0)}).style("fill",function(n,t){return w(t)}).attr("cx",function(){return c(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin/1.5}).attr("cy",function(){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))}).attr("r",function(){return t.option.suppress.transition==!1?1:e+eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')/r}).transition().duration(t.option.suppress.transition==!1?1500:0).attr("r",function(n){return n[t.pattern.dataKey.plotAxis.key]==0?0:e+eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')/r}).on("end",function(){it=!0;_get.d3.visual(n._id).on("mousemove",function(){if(d3.event.offsetX<t.scale.margin||d3.event.offsetY<t.scale.margin/2||d3.event.offsetX>t.scale.width+3*t.scale.margin||d3.event.offsetY>t.scale.height+1*t.scale.margin?a("hide"):i.attr("data-mouse-in-point")=="0"?a("show"):a("hide"),p.style("display")!="none"){p.attr("d",`M${t.scale.margin+1} ${d3.event.offsetY} l${t.scale.width+2*t.scale.margin} 0`);b.attr("d",`M${d3.event.offsetX} ${t.scale.margin/2} v${t.scale.height+t.scale.margin/2} 0`);s.attr("transform","translate("+(d3.event.offsetX+5)+", "+(d3.event.offsetY-5)+")");let n=t.pattern.dataKey.plotAxis;s.select("#t1").text(`${_isNotNullOrEmpty(n.title)?n.title:n.key}: `);s.select("#t2").text(`${Math.round(u.invert(d3.event.offsetY),0)}`)}})});o.selectAll(".ve-text-default").data(t._data).enter().append("text").attr("class","ve-text-default v-text-noselect").style("text-align","middle").style("font-size",function(){return Math.round(e/2,0)*1.8+"px"}).text(function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')}).attr("x",function(){return c(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin/1.5}).attr("y",function(){return t.option.suppress.transition==!1?u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')):u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-(e+eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')/r)*1.25}).transition().duration(t.option.suppress.transition==!1?1500:0).attr("y",function(){return u(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-(e+eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')/r)*1.25});t.option.suppress.legend!=!0&&sn.visual._core_lib._set_legend({param:t,legendHolder:o,keys:sn.visual.helper.getLegendValues(t),colorScale:w})},_draw_visual_line_vertical:function(n){function tt(){return t.scale.width<=100||t.scale.height<=100}function u(){return tt()?9:_get.d3.holder(n._id).classed("vh-full")?12:9}function v(){return tt()?9:_get.d3.holder(n._id).classed("vh-full")?14:12}function c(n){n=="show"?(y.style("display","inline"),w.style("display","inline"),o.style("display","inline")):n=="hide"&&(y.style("display","none"),w.style("display","none"),o.style("display","none"))}var et=n["visual-holder"],nt=n["visual-tooltip"],i=n.visual,t=n.param,h,s,l,d,g,a;t.option.suppress.elementShadow==!1;_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").size()>0?_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").text(t.basic.title):_get.d3.title(`${n._id}`).text(t.basic.title);i.attr("data-mouse-in-point","0");var r=d3.scaleBand().range([t.scale.margin+1,t.scale.width+2*t.scale.margin]).padding(.4),f=d3.scaleLinear().range([t.scale.height+t.scale.margin,t.scale.margin/2]),p=d3.scaleOrdinal().range(t.pattern.dataKey.plotAxis.colors),e=i.append("g").attr("class","ve-inter-group-default").attr("transform","translate("+t.scale.margin*1+",0)"),ft=d3.max(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')});r.domain(t._data.map(function(){return eval('d["'+t.pattern.dataKey.baseAxis.key+'"]')}));f.domain([0,d3.max(t._data,function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')})]).nice();h=e.append("g").attr("transform","translate("+-1*t.scale.margin+", "+(t.scale.height+t.scale.margin)+")").style("font-size",u()+"px").style("cursor","default").call(d3.axisBottom(r).tickFormat(function(n){return(t.pattern.dataKey.baseAxis.prefix!=null?t.pattern.dataKey.baseAxis.prefix:"")+n+(t.pattern.dataKey.baseAxis.suffix!=null?t.pattern.dataKey.baseAxis.suffix:"")}));sn.visual._core_lib._set_axis_text_direction(h,"bottom",t.pattern.dataKey.baseAxis.textDirection);h.on("mousemove",function(){h.transition().style("font-size",v()+"px")}).on("mouseout",function(){h.transition().style("font-size",u()+"px")});let y=i.append("path").style("stroke","orange").style("stroke-width",1).style("stroke-dasharray","2, 2"),w=i.append("path").style("stroke","orange").style("stroke-width",1).style("stroke-dasharray","2, 2"),o=i.append("g").attr("transform","translate(0, 0)"),it=o.append("text").style("fill","orangered").style("font-family","Segoe UI").attr("class","v-text-noselect");it.append("tspan").attr("id","t1").style("font-size","7px").style("font-weight","bold").style("opacity","0.5");it.append("tspan").attr("id","t2").style("font-weight","bold").style("font-size","11px");t.pattern.dataKey.plotAxis.tickStyle=="auto"?s=e.append("g").attr("transform","translate(1, 0)").style("font-size",u()+"px").style("cursor","default").call(d3.axisLeft(f).tickFormat(function(n){return(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")})):(l=d3.axisLeft(f),t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"?t.option.suppress.blankTicks==!1?l.tickFormat(function(n){return t.pattern.dataKey.plotAxis.tickStyle=="no-decimal"&&(n.toString().indexOf(".")>=0||n%t.pattern.dataKey.plotAxis.tickIncrement!=0)?"":(t.pattern.dataKey.plotAxis.prefix!=null?t.pattern.dataKey.plotAxis.prefix:"")+n+(t.pattern.dataKey.plotAxis.suffix!=null?t.pattern.dataKey.plotAxis.suffix:"")}):l.tickFormat(d3.format(".0f")).tickValues(d3.range(0,ft+1,t.pattern.dataKey.plotAxis.tickIncrement)):t.pattern.dataKey.plotAxis.tickStyle=="blank"&&l.tickValues(d3.range(0,0,0)),s=e.append("g").attr("transform","translate(1, 0)").call(l));sn.visual._core_lib._set_axis_text_direction(s,"left",t.pattern.dataKey.plotAxis.textDirection);s.on("mousemove",function(){s.transition().style("font-size",v()+"px")}).on("mouseout",function(){s.transition().style("font-size",u()+"px")});let b=i.append("text").attr("class","va-text-plotaxis v-text-noselect").attr("transform",function(){return"translate("+t.scale.margin/4+","+(t.scale.height/2+t.scale.margin)+") rotate(270)"}).style("font-size",u()+"px").text(t.pattern.dataKey.plotAxis.title);b.on("mousemove",function(){b.transition().style("font-size",v()+"px")}).on("mouseout",function(){b.transition().style("font-size",u()+"px")});let k=i.append("text").attr("class","va-text-baseaxis v-text-noselect").attr("transform",function(){return"translate("+(t.scale.margin+(t.scale.width+t.scale.margin)/2)+","+(t.scale.height+(_get.d3.holder(n._id).classed("vh-full")?3:1.75)*t.scale.margin)+")"}).style("font-size",u()+"px").text(t.pattern.dataKey.baseAxis.title);k.on("mousemove",function(){k.transition().style("font-size",v()+"px")}).on("mouseout",function(){k.transition().style("font-size",u()+"px")});d=d3.line().x(function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin+r.bandwidth()/2}).y(function(){return f(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))});t.pattern.type=="curve-line"&&d.curve(d3.curveMonotoneX);g=e.append("path").datum(t._data).attr("class","ve-connector-default").style("fill",t.pattern.fillArea==!0?"steelblue":"none").style("stroke-linejoin","round").style("stroke-linecap","round").style("stroke-opacity","0.5").style("stroke-width","1px").attr("d",d);a=g.node().getTotalLength();g.style("stroke-dasharray",a+" "+a).style("stroke-dashoffset",a).transition().duration(t.option.suppress.transition==!1?1500:0).ease(d3.easeLinear).style("stroke-dashoffset",t.option.suppress.transition==!1?0:a);let rt=3,ut=!1;e.selectAll(".ve-default").data(t._data).enter().append("circle").attr("class",function(){return _get.is_visual_interactable(t)==!0?"ve-inter-default ve-default ":" ve-default "}).attr("data-visual-id",_get.id.visual(n._id)).on("click",function(){sn.visual._core_lib._visual_element_click_handling({"this":this,visualId:d3.select(this).attr("data-visual-id"),param:t})}).on("mousemove",function(u,f){ut==!0&&(c("hide"),i.attr("data-mouse-in-point",1),sn.visual._core_lib._visual_element_mousemove_handling({d:u,i:f,ttDistance:r.bandwidth()/3,colorScale:p,visual:i,visualToolTip:nt,param:t,id:n._id}),d3.select(this).attr("r",5).classed("ve-mouse-on",!0).style("fill",p(f)))}).on("mouseout",function(){nt.style("display","none");d3.select(this).attr("r",rt).classed("ve-mouse-on",!1).style("fill","white");c("show");i.attr("data-mouse-in-point",0)}).attr("cx",function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin+r.bandwidth()/2}).attr("cy",function(){return f(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))}).attr("r",0).transition().duration(t.option.suppress.transition==!1?3e3:0).attr("r",rt).style("fill",function(){return"white"}).style("stroke","steelblue").style("stroke-width","2px").on("end",function(){ut=!0;_get.d3.visual(n._id).on("mousemove",function(){if(d3.event.offsetX<t.scale.margin||d3.event.offsetY<t.scale.margin/2||d3.event.offsetX>t.scale.width+2*t.scale.margin||d3.event.offsetY>t.scale.height+t.scale.margin?c("hide"):i.attr("data-mouse-in-point")=="0"?c("show"):c("hide"),y.style("display")!="none"){y.attr("d",`M${t.scale.margin+1} ${d3.event.offsetY} l${t.scale.width+t.scale.margin} 0`);w.attr("d",`M${d3.event.offsetX} ${t.scale.margin/2} v${t.scale.height+t.scale.margin/2} 0`);o.attr("transform","translate("+(d3.event.offsetX+5)+", "+(d3.event.offsetY-5)+")");let n=t.pattern.dataKey.plotAxis;o.select("#t1").text(`${_isNotNullOrEmpty(n.title)?n.title:n.key}: `);o.select("#t2").text(`${Math.round(f.invert(d3.event.offsetY),0)}`)}})});t.option.suppress.textOnElement==!1&&e.selectAll(".ve-text-default").data(t._data).enter().append("text").attr("class","ve-text-default v-text-noselect").style("font-size",function(){return"x-small"}).style("fill",function(){return"gray"}).attr("x",function(){return r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin+r.bandwidth()/2}).attr("y",function(){return f(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-t.scale.margin/4}).transition().duration(t.option.suppress.transition==!1?3e3:0).text(function(){return eval('d["'+t.pattern.dataKey.plotAxis.key+'"]')});e.selectAll("rect").each(function(){t.option.suppress.elementShadow==!1&&d3.select(this).attr("stroke-width",1).style("filter","url(#drop-shadow)").attr("transform",function(){return"translate("+(r(eval('d["'+t.pattern.dataKey.baseAxis.key+'"]'))-t.scale.margin)+","+f(eval('d["'+t.pattern.dataKey.plotAxis.key+'"]'))-100+")"})});t.option.suppress.legend!=!0&&sn.visual._core_lib._set_legend({param:t,legendHolder:e,keys:sn.visual.helper.getLegendValues(t),colorScale:p})},_draw_visual_pie_doughnut:function(n){function nt(n){n.innerRadius=0;var t=d3.interpolate({startAngle:0,endAngle:0},n);return function(n){return l(t(n))}}function tt(){t=d3.select(this);t.transition().attr("d",d)}function it(){t=d3.select(this);t.transition().attr("d",l)}var b=n.visual,ut=n["visual-holder"],k=n["visual-tooltip"],i=n.param,a,e,f,y,l,d,s,h,p,rt;_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").size()>0?_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").text(i.basic.title):_get.d3.title(`${n._id}`).text(i.basic.title);a=i.pattern.dataKey.baseAxis.key;e=i.pattern.dataKey.plotAxis.key;let u=i._data.length==0;if(u){let n={};n[a]="(no data)";n[e]=1;i._data.push(n);i.pattern.dataKey.plotAxis.colors=["#F0F0F0"]}else sn.visual._core_lib._set_colors_from_scheme(i,!0);f=!0;i.option.suppress.elementShadow==!1&&sn.visual._core_lib._define_visual_bar_element_shadow(n);let v=Math.min(i.scale.width,i.scale.height);var r=v<=100?v*.85:v*.5,c=d3.scaleOrdinal().range(i.pattern.dataKey.plotAxis.colors),o=b.append("g").attr("class","ve-inter-group-default").attr("transform","translate("+(i.scale.width/2+i.scale.margin)+","+(i.scale.height/2+i.scale.margin)+")").attr("width",i.scale.width+"px");if(i.pattern.type=="doughnut"){let n=9+Math.max(i.scale.width,i.scale.height)/100;o.append("text").attr("class","v-text-noselect").style("text-anchor","middle").style("font-size",n-1).text(function(){return u?"":"Total"}).attr("y","-"+n/2+"px").style("opacity",i.option.suppress.transition==!1?"0":"1").transition().duration(i.option.suppress.transition==!1?2250:0).style("opacity","0.5");o.append("text").attr("class","v-text-noselect").style("text-anchor","middle").style("font-weight","bold").style("font-size",n<14?14:n).text(function(){return u?"":d3.sum(i._data,function(n){return n[e]})}).attr("y",n/2+2+"px").style("opacity",i.option.suppress.transition==!1?"0":"1").on("mouseenter",function(){d3.select(this).transition().style("font-size",(n<14?14:n)+n/2+"px")}).on("mouseout",function(){d3.select(this).transition().style("font-size",(n<14?14:n)+"px")}).transition().duration(i.option.suppress.transition==!1?2250:0).style("opacity","1")}if(y=d3.pie().sort(null).value(function(){return eval("d['"+e+"']")}),l=d3.arc().outerRadius(r).innerRadius(i.pattern.type=="doughnut"?r-r/1.5:.1),d=d3.arc().outerRadius(r+7).innerRadius(7+(i.pattern.type=="doughnut"?r-r/1.5:.1)),this._fn_label_radius=function(){return r+(f==!0?-1:1)*r/(i.pattern.type=="doughnut"?4:f==!0?2:3)},s=d3.arc().outerRadius(this._fn_label_radius()).innerRadius(this._fn_label_radius()),h=o.selectAll(".ve-default").data(y(i._data)).enter().append("g").attr("class",function(){return(_get.is_visual_interactable(i)==!0?"ve-inter-default ve-default ":" ve-default ")+(i.pattern.type=="doughnut"?" ve-doughnut-default ":" ve-pie-default ")}).style("fill",function(n,t){return c(t)}).attr("data-visual-id",_get.id.visual(n._id)).on("click",function(){sn.visual._core_lib._visual_element_click_handling({"this":this,visualId:d3.select(this).attr("data-visual-id"),param:i})}),f==!1){p=d3.arc().outerRadius(this._fn_label_radius()/3).innerRadius(this._fn_label_radius()/3);function n(n){return n.startAngle+(n.endAngle-n.startAngle)/2}}let g=!1;h.append("path").attr("d",l).on("mouseenter",tt).on("mouseout.animate",it).on("mousemove",function(t,r){u==!1&&g==!0&&sn.visual._core_lib._visual_element_mousemove_handling({d:t,i:r,ttDistance:30,colorScale:c,visual:b,visualToolTip:k,param:i,id:n._id})}).on("mouseout.tooltip",function(){u==!1&&k.style("display","none")}).transition().ease(d3.easeCircle).duration(i.option.suppress.transition==!1?1500:0).attrTween("d",i.option.suppress.transition==!1?nt:null).on("end",function(){g=!0});f==!1&&(rt=h.append("rect").attr("style","width: 20px; height: 20px; fill-opacity: 1; fill: #efffdd; stroke-width: 1; stroke: lightgray; stroke-linejoin: round;").attr("transform",function(n){return this.centroid=s.centroid(n),this.centroid[0]-=10,this.centroid[1]-=20/1.5,"translate("+this.centroid[0]+", "+this.centroid[1]+")"}));let w=function(){let n=Math.round(r/10,0);return n<9?9:n};h.append("text").text(function(){return u?"0":(_isNotNullOrEmpty(i.pattern.dataKey.plotAxis.prefix)?i.pattern.dataKey.plotAxis.prefix+" ":_emptyStr)+eval("d.data['"+e+"']")+(_isNotNullOrEmpty(i.pattern.dataKey.plotAxis.suffix)?" "+i.pattern.dataKey.plotAxis.suffix:_emptyStr)}).attr("class","ve-text-default v-text-noselect").style("font-weight","normal").style("stroke","white").style("text-align","end").style("font-size",function(){return w()+"px"}).attr("transform",function(n){return i.option.suppress.transition==!1?"translate(0)":"translate("+s.centroid(n)+")"}).on("mouseenter",function(){d3.select(this).transition().style("font-size",w()+9+"px")}).on("mouseout",function(){d3.select(this).transition().style("font-size",w()+"px")}).transition().ease(d3.easeCircle).duration(1500).style("stroke",function(n,t){return f==!0?u?"darkgray":sn.visual._core_lib._get_color_readable(c(t)):"black"}).attr("transform",function(n){return"translate("+s.centroid(n)+")"}).on("end",function(){if(f==!1){var t=a,n=h.selectAll(".v-polyline").data(y(i._data),function(n){return n.data[t]});n.enter().append("polyline").attr("class","v-polyline").attr("style","opacity: .3; stroke: black; stroke-width: 2px; fill: none;");n.transition().duration(1e3).attrTween("points",function(n){this._current=this._current||n;var t=d3.interpolate(this._current,n);return this._current=t(0),function(n){var i=t(n),u=p.centroid(i);return u[0]=r*.95*(midAngle(i)<Math.PI?1:-1),[s.centroid(i),p.centroid(i),u]}});n.exit().remove()}});o.selectAll("rect").each(function(){i.option.suppress.elementShadow==!1&&d3.select(this).attr("stroke-width",1).style("filter","url(#drop-shadow)")});i.option.suppress.legend!=!0&&sn.visual._core_lib._set_legend({param:i,legendHolder:o,keys:sn.visual.helper.getLegendValues(i),colorScale:c})},_draw_visual_table_vertical:function(n){var o=n["visual-holder"],c=n.visual,t=n.param,r,v;_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").size()>0?_get.d3.titleContainer(`${n._id}`).select(".v-head-text-holder").text(t.basic.title):_get.d3.title(`${n._id}`).text(t.basic.title);const f="_scroll_fill",h="_check_box";r={_invoke_child_visuals:function(n){this.visualsToRefresh=sn.visual._model.filter(t=>t["parent-visual-id"]==n);this.tbody=d3.select("#"+n+" tbody");var t=[],i;i=this.tbody.selectAll("tr").filter(".ve-inter-unselected").size()==0?this.tbody.selectAll("tr").filter(".ve-inter-default"):this.tbody.selectAll("tr").filter(".ve-inter-selected");i.each(function(n){t.push(n)});sn.visual._core_lib._refresh_children(this.visualsToRefresh,t)},_switch_selection:function(n,t){this.tbody=d3.select("#"+n+" tbody");this.tfoot=d3.select("#"+n+" tfoot");this.tbody.selectAll(".ve-inter-default").classed("ve-inter-unselected",t==!1);this.tbody.selectAll(".ve-inter-default").classed("ve-inter-table-unselected",t==!1);this.tbody.selectAll(".ve-inter-default").classed("ve-inter-selected",t==!0);this.tfoot.selectAll("tr").classed("ve-inter-unselected",t==!1);this.tfoot.selectAll("tr").classed("ve-inter-table-unselected",t==!1);this.tfoot.selectAll("tr").classed("ve-inter-selected",t==!0)},_get_col_head_text:function(n){let i;if(n.name==f)i=_emptyStr;else if(n.name==t.pattern.dataKey.baseAxis.key)i=t.pattern.dataKey.baseAxis.title?t.pattern.dataKey.baseAxis.title:t.pattern.dataKey.baseAxis.key;else if(n.name==t.pattern.dataKey.plotAxis.key)i=t.pattern.dataKey.plotAxis.title?t.pattern.dataKey.plotAxis.title:t.pattern.dataKey.plotAxis.key;else{let r=t.pattern.dataKey.baseAxis.moreKey.filter(t=>t.key==n.name)[0];i=_isNotNullOrEmpty(r)?r.title:n.name;i=_isNullOrEmpty(i)?n.name:i}return i},_invoke_listeners:function(n){let i={"this":n,visualId:d3.select(n).attr("data-visual-id"),param:t};if(i.param.listener&&i.param.listener.onVisualElementClick){let n={selected:[]};try{if(this.tbody){let r,t;this.tbody.selectAll(".ve-inter-default").filter(".ve-inter-selected").each(function(u){r=_isNotNullOrEmpty(u.data)?u.data:u;t=_get.json_cloned(r);delete t._id;t.key=_isNullOrEmpty(t.key)?r[i.param.pattern.dataKey.baseAxis.key]:t.key;t.value=_isNullOrEmpty(t.value)?r[i.param.pattern.dataKey.plotAxis.key]:t.value;n.selected.push(t)})}}catch(r){(r.message||r.stack)&&console.error(r.message+r.stack)}i.param.listener.onVisualElementClick(n)}},_switch_foot_selection:function(n){d3.select("#"+n+" tbody").selectAll("tr").classed("ve-inter-selected",!0).selectAll("tr").classed("ve-inter-unselected",!1).selectAll("tr").classed("ve-inter-table-unselected",!1);d3.select("#"+n+" tfoot").selectAll("tr").classed("ve-inter-selected",!0).selectAll("tr").classed("ve-inter-unselected",!1).selectAll("tr").classed("ve-inter-table-unselected",!1)}};let e=c.append("table").attr("class","vt-default v-text-noselect").style("display","grid").style("border-spacing","0px").style("font-size",t.decoration.textSize+"px").style("width","100%");if(t.option.suppress.toolBar==!0){let i=e.append("caption").text(t.basic.title).attr("id",_get.id.tcaption(n._id)).attr("class","vt-caption v-text-noselect v-text-overflow-hide").style("width",o.style("width")).style("background-color",t.scale.tile.hostColor).style("color",sn.visual._core_lib._get_color_readable(t.scale.tile.hostColor));_set.element.text_as_title(i.attr("id"))}var l=e.append("thead").attr("class","vt-head").style("display","table").style("width","100%").style("table-layout","fixed").style("border-bottom-color",t.scale.tile.hostColor),p=e.append("tbody").attr("class","ve-inter-group-default").style("height",t.scale.height+(_isNullOrEmpty(t.pattern.dataKey.plotAxis.summaryReduceMethod)?t.scale.margin+t.scale.tile.margin:0)+"px").style("display","block").style("overflow-y","scroll"),a=e.append("tfoot").attr("class","vt-foot").style("display","table").style("width","100%").style("table-layout","fixed").style("border-top-color",t.scale.tile.hostColor);let u=[];t.option.suppress.checkBox==!1&&u.push({name:h,title:_emptyStr,_internal:!0});u.push({name:t.pattern.dataKey.baseAxis.key,title:t.pattern.dataKey.baseAxis.title,_internal:!1});_isNotNullOrEmpty(t.pattern.dataKey.baseAxis.moreKey)==!0&&t.pattern.dataKey.baseAxis.moreKey.forEach(function(n){u.push({name:n.key,title:n.title?n.title:n.key,_internal:!1})});u.push({name:t.pattern.dataKey.plotAxis.key,title:t.pattern.dataKey.plotAxis.title,_internal:!1});u.push({name:f,title:_emptyStr,_internal:!0});let i=[],s=!1;v=t.scale.width/u.length;let y=l.append("tr").selectAll("th").data(u).enter().append("th").on("click",function(f){if(f._internal==!1){let l=o.style("cursor");try{let o=i.findIndex(n=>n[f.name]!=null);if(o>=0&&(i[o][f.name].newSortState=i[o][f.name].sortedState=="asc"?"asc":"asc"),d3.event.shiftKey==!0){if(s==!0){let n=i.findIndex(n=>n[f.name]!=null);n>-1&&i[n][f.name].sortedState==i[n][f.name].newSortState&&i.splice(n,1)}s=!0}else s=!1,i.length>1?i=[i[i.length-1]]:i.length==1&&i.filter(n=>n[f.name]!=null).length==0&&(i=[]);if(o=i.findIndex(n=>n[f.name]!=null),o==-1){let n={};n[f.name]={sortedState:"asc"};i.push(n);o=i.findIndex(n=>n[f.name]!=null)}let l=o==-1?"":i[o][f.name].newSortState;_isNullOrEmpty(l)==!0&&(l="asc");var h=_emptyStr,c=_emptyStr;i.map(function(n){return Object.keys(n)[0]}).forEach(function(n){h+=(_isNotNullOrEmpty(h)?" + ":"")+`scp_1['${n}']`});c=h.replace(/scp_1/g,"scp_2");t._data=_isNullOrEmpty(l)||l=="asc"?t._data.sort(function(){return eval("d3.ascending(eval(sortComparePhrase_1), eval(sortComparePhrase_2))")}):t._data.sort(function(){return eval("d3.descending(eval(sortComparePhrase_1), eval(sortComparePhrase_2))")});e.selectAll("tbody > tr").remove();render_data_rows(u,t,n);r._switch_foot_selection(n["visual-id"]);i[o][f.name].sortedState=l}finally{o.style("cursor",l)}y.html(function(n){let t=i.findIndex(t=>t[n.name]!=null),r=t==-1?"":i[t][n.name].sortedState;return`<sub style="color: black; font-weight: bolder; font-size: xx-small;">`+`${t>=0&&i.length>1?t+1:""}</sub>`+`<span class="fa ${r=="asc"?"fa-sort-alpha-down":""}"></span>&nbsp;`+`<b>${n.title}</b>`})}}).attr("class",function(n){return n.name==t.pattern.dataKey.baseAxis.key?"vt-c-text":t._data.length>0&&_isNotNullOrEmpty(n.name)&&typeof t._data[0][n.name]=="number"?"vt-c-number":"vt-c-text"}).style("border-right",function(n){return n.name==f?"0px":d3.select(this).attr("border-right")}).style("width",function(n){return n.name==f?"14px":d3.select(this).attr("width")}).attr("title",function(n){return r._get_col_head_text(n)}).text(function(n){return r._get_col_head_text(n)}).html(function(i){return t.option.suppress.checkBox==!1&&i.name==h?`<input id="checkAll${n._id}" type="checkbox" style="width: 9px; height: 9px;" title="Check / Uncheck All"/>`:d3.select(this).html()});d3.select(`#checkAll${n._id}`).on("click",function(){console.log("check-all-clicked")});render_data_rows=function(n,t,i){let u=d3.select("#"+i["visual-id"]+" table"),e=u.selectAll("tbody").selectAll("tr").data(t._data).enter().append("tr").style("display","table").style("width","100%").style("table-layout","fixed").attr("class",function(n,i){return"table-row "+(_get.is_visual_interactable(t)?"ve-inter-default ":"")+" ve-inter-table-default vt-r-data "+(i%2==1?"vt-r-data-even":"")}).attr("data-visual-id",_get.id.visual(i._id)).on("mousedown",function(){_get.is_visual_interactable(t)&&d3.select(this).classed("ve-grabbing",d3.event.ctrlKey==!0)}).on("mouseup",function(){_get.is_visual_interactable(t)&&d3.select(this).classed("ve-grabbing",!1)}).on("click",function(){_get.is_visual_interactable(t)&&(this.tbody=d3.select("#"+d3.select(this).attr("data-visual-id")+" tbody"),this.tfoot=d3.select("#"+d3.select(this).attr("data-visual-id")+" tfoot"),d3.select(this).classed("ve-inter-selected")==!0&&this.tbody.selectAll(".ve-inter-selected").size()==1?r._switch_selection(d3.select(this).attr("data-visual-id"),!0):d3.event.ctrlKey==!0?(d3.select(this).classed("ve-inter-selected",d3.select(this).classed("ve-inter-selected")==!0?!1:!0),d3.select(this).classed("ve-inter-unselected",d3.select(this).classed("ve-inter-selected")==!1),d3.select(this).classed("ve-inter-table-unselected",d3.select(this).classed("ve-inter-selected")==!1),this.tbody.selectAll(".ve-inter-default").size()==this.tbody.selectAll(".ve-inter-selected").size()?(this.tfoot.selectAll("tr").classed("ve-inter-unselected",!1),this.tfoot.selectAll("tr").classed("ve-inter-table-unselected",!1),this.tfoot.selectAll("tr").classed("ve-inter-selected",!0)):(this.tfoot.selectAll("tr").classed("ve-inter-unselected",!0),this.tfoot.selectAll("tr").classed("ve-inter-table-unselected",!0),this.tfoot.selectAll("tr").classed("ve-inter-selected",!1))):(r._switch_selection(d3.select(this).attr("data-visual-id"),!1),d3.select(this).classed("ve-inter-selected",!0)),r._invoke_child_visuals(d3.select(this).attr("data-visual-id")));r._invoke_listeners(this)});var o=e.selectAll("td").data(function(t){return n.filter(n=>n.name!=f).map(function(n){return{key:n,value:t[n.name],_id:t._id}})}).enter().append("td").style("border-right","1px solid lightgray").attr("nowrap","1").attr("class",function(n){return n.key.name==t.pattern.dataKey.baseAxis.key?"vt-c-text":typeof n.value=="number"?"vt-c-number":"vt-c-text"}).attr("title",function(n){return n.value}).text(function(n){return n.value}).attr("data-check-box-id",function(n){return t.option.suppress.checkBox==!1&&_isNullOrEmpty(n.value)?`check${n._id}`:""}).on("mouseenter",function(){d3.select(this).classed("vt-cell-mouseover",!0)}).on("mouseleave",function(){d3.select(this).classed("vt-cell-mouseover",!1)});o.html(function(){return d3.select(this).attr("data-check-box-id")!=""?`<input id="${d3.select(this).attr("data-check-box-id")}" type="checkbox" style="width: 9px; height: 9px;" />`:d3.select(this).html()})};render_data_rows(u,t,n);_isNotNullOrEmpty(t.pattern.dataKey.plotAxis.summaryReduceMethod)&&a.append("tr").attr("data-visual-id","visual"+n._id).on("click",function(){this.tbody=d3.select("#"+d3.select(this).attr("data-visual-id")+" tbody");_get.is_visual_interactable(t)&&(r._switch_foot_selection(d3.select(this).attr("data-visual-id")),r._invoke_child_visuals(d3.select(this).attr("data-visual-id")));r._invoke_listeners(this)}).selectAll("th").data(u).enter().append("th").attr("class",function(n){return n.name==t.pattern.dataKey.baseAxis.key?"vt-c-text":t._data.length>0&&_isNotNullOrEmpty(n.name)&&typeof t._data[0][n.name]=="number"?"vt-c-number vt-c-summary":"vt-c-text"}).style("border-right",function(n){return n.name==f?"0px":d3.select(this).attr("border-right")}).style("width",function(n){return n.name==f?"14px":d3.select(this).attr("width")}).text(function(n){return _isNotNullOrEmpty(n.name)?sn.visual.helper.reduceToSummaryValue(n.name,t):_emptyStr})},_draw_visual_check_list_vertical:function(n){var o=n["visual-holder"],r=n.visual,t=n.param;let u=function(n){sn.visual._core_lib._visual_element_click_handling({"this":n,visualId:d3.select(n).attr("data-visual-id"),param:t});let i=d3.select("#"+d3.select(n).attr("data-visual-id")+" .ve-inter-group-default");i.selectAll(".ve-inter-default").each(function(){let n=d3.select(this);n.classed("ve-inter-selected")==!0?n.select("input").attr("checked","true"):n.select("input").attr("checked",null)})},f=function(){let t=d3.select("#selectall_"+n._id);t.attr("data-selectedall")==0?(t.style("background-color","black").style("color","white").attr("data-selectedall",1),i.selectAll("input").attr("checked",!0),i.classed("ve-inter-selected",!0)):(t.style("background-color","white").style("color","black").attr("data-selectedall",0),i.selectAll("input").attr("checked",null),i.classed("ve-inter-selected",!1))};if(r.style("font-size",t.decoration.textSize+"px"),t.option.suppress.toolBar==!0){let i=r.append("span").text(t.basic.title).attr("class","v-text-noselect v-text-overflow-hide").attr("id",_get.id.tcaption(n._id)).style("font-size",t.decoration.textSize+5+"px").style("font-weight","bold").style("width","100%");_set.element.text_as_title(i.attr("id"));i.append("label").text("All").attr("id","selectall_"+n._id).style("font-size",t.decoration.textSize+"px").style("margin-left","2px").style("border","1px solid black").style("border-radius","3px").style("padding-left","1px").style("padding-right","2px").attr("data-visual-id",_get.id.visual(n._id)).attr("data-selectedall",0).on("click",function(){f()})}let e=r.append("ul").attr("class","v-check-list-item-group ve-inter-group-default").style("list-style","none"),i=e.selectAll("li").data(t._data).enter().append("li").attr("data-visual-id",_get.id.visual(n._id)).attr("class",function(){return"v-check-list-item-default "+(_get.is_visual_interactable(t)==!0?"ve-inter-default  ":"")}).on("click",function(){u(this);let t=d3.select("#selectall_"+n._id);t.style("background-color","white").style("color","black").attr("data-selectedall",0)});i.append("input").attr("class","v-check-box").attr("id",function(t,i){return`cb_${i}_${n._id}`}).attr("disabled","true").attr("type","checkbox").on("click",function(){u(this.parentElement)});i.append("label").attr("class","v-text-noselect").style("font-size",t.decoration.textSize+2+"px").style("margin-left","2px").attr("for",function(t,i){return`cb_${i}_${n._id}`}).text(function(n){return`${n[t.pattern.dataKey.baseAxis.key]}`})}},_color_scheme:{"pbi-default-darker":["#666666","#000000","#015C55","#1C2325","#7F312F","#796408","#303637","#456A76","#7F4B33"],"pbi-default-dark":["#808080","#1A1A1A","#018A80","#293537","#BE4A47","#B6960B","#475052","#689FB0","#BF714D"],"pbi-default-normal":["#B3B3B3","#333333","#34C6BB","#5F6B6D","#FD817E","#F5D33F","#7F898A","#A1DDEF","#FEAB85"],"pbi-default-light":["#CCCCCC","#666666","#67D4CC","#879092","#FEA19E","#F7DE6F","#9FA6A7","#B9E5F3","#FEC0A3"],"pbi-default-lighter":["#e6e6e6","#999999","#99e3dd","#afb5b6","#fec0bf","#fae99f","#bfc4c5","#d0eef7","#ffd5c2"],"pbi-default-bright":["#01b8aa","#000000","#374649","#fd625e","#f2c80f","#5f6b6d","#8ad4eb","#fe9666"]},_message_template:{_error_suffix:"Missing details in parameter will lead to experience visual not rendered, incorrectly rendered or not behaving as expected.",_warning_suffix:"Missing details in parameter may lead to experience visual not rendered, incorrectly rendered or not behaving as expected.",_simple:"sn.visual: %s. ",_key_value:"sn.visual: %s. %s: %o.",_validlist_key_value:"sn.visual: %s. %o %s: %o.",get:function(n){switch(n){case"error":return this._simple+this._error_suffix;case"error-key-value":return this._key_value+this._error_suffix;case"error-validlist-key-value":return this._validlist_key_value+this._error_suffix;case"warning":return this._simple+this._warning_suffix;case"warning-key-value":return this._key_value+this._warning_suffix;case"warning-validlist-key-value":return this._validlist_key_value+this._warning_suffix}}},_model:[],create:function(n){var u,i,t;let r=null;try{this._core_lib._set_interaction_mode(n,this.default.param.option.behaviour.interactionMode);this._core_lib._casacade_down_the_interaction_mode(n,n.option.behaviour.interactionMode);u=this.helper.validateParam(n);u==!0&&(n.pattern.orientation=n.pattern.type=="bar"&&n.pattern.orientation==null?"vertical":n.pattern.orientation,n=this.helper.handleParam(n),n.data&&(n._data=_get.json_cloned(n.data),this.helper.reduceParamPlotValue(n,n._data),n.option.behaviour.interactionMode=="auto"&&this.helper.setUniqueIdToData(n),n.data=_get.json_cloned(n._data),i=this._core_lib._get_draw_visual_routine(n.pattern.type,n.pattern.orientation),typeof i=="function"&&(t=this._core_lib._get_visual_ground_created(n,i),t["visual-id"]="visual"+t._id,i(t),n.option.behaviour.interactionMode=="auto"&&n.children&&n.children.length>0&&n.children.forEach(function(i){var f=i.pattern.dataKey.baseAxis.dataSourceKey,o=i.pattern.dataKey.baseAxis.groupKey,r=[],e,u;i.pattern.type=="bar-grouped"&&_isNotNullOrEmpty(o)==!0?(n.data.forEach(function(n){let t={};t[i.pattern.dataKey.baseAxis.key]=n[i.pattern.dataKey.baseAxis.key];t[i.pattern.dataKey.baseAxis.groupKey]=n[i.pattern.dataKey.baseAxis.groupKey];r.push(t)}),i._data=_get.json_cloned(r)):_isNotNullOrEmpty(f)==!0&&(n.data.forEach(function(n){n[f].forEach(function(n){r.push(n)})}),r=_get.json_cloned(r),i._data=sn.visual.helper.reduceSelectedAll(i,r));i.data=_get.json_cloned(i._data);e=sn.visual.create(i);u=sn.visual._model.filter(n=>n._id==e.id)[0];_isNotNullOrEmpty(u)&&(u["parent-visual-id"]=_get.id.visual(t._id))}),sn.visual._model.push(t),r={id:t._id})))}catch(f){sn.visual.helper.handleException(f)}return r},update:function(n){let i=!1;try{if(n==null)throw{error:"Parameter is missing"};if(n.id==null)throw{error:"Parameter does not have the 'id' of visual",key:"updateParam",value:n};const r=sn.visual._model.findIndex(t=>t._id==n.id);if(r<0)throw{error:"Unable to find the visual with the 'id' property specified",key:"updateParam",value:n};if(n.data==null)throw{error:"Parameter does not have 'data'",key:"updateParam",value:n};let t=sn.visual._model[r];t.param._data=_get.json_cloned(n.data);t.param.basic.title=n.basic&&n.basic.title?n.basic.title:t.param.basic.title;t.param.pattern.dataKey.baseAxis.title=n.pattern&&n.pattern.dataKey&&n.pattern.dataKey.baseAxis?n.pattern.dataKey.baseAxis.title:t.param.pattern.dataKey.baseAxis.title;t.param.pattern.dataKey.plotAxis.title=n.pattern&&n.pattern.dataKey&&n.pattern.dataKey.plotAxis?n.pattern.dataKey.plotAxis.title:t.param.pattern.dataKey.plotAxis.title;let u=this._core_lib._get_draw_visual_routine(t.param.pattern.type,t.param.pattern.orientation);typeof u=="function"&&(d3.selectAll("#"+t["visual-id"]+" > *").remove(),u(t),i=!0)}catch(t){t.error&&(t.error+=". Unable to proceed with update");sn.visual.helper.handleException(t)}return i}};